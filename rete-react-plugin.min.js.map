{"version":3,"file":"rete-react-plugin.min.js","sources":["../src/utils.ts","../src/presets/classic/components/ConnectionWrapper.tsx","../src/presets/classic/components/Connection.tsx","../src/shared/utils.ts","../src/shared/drag.tsx","../src/presets/classic/components/Control.tsx","../src/presets/classic/vars.ts","../src/ref-component.tsx","../src/presets/classic/components/refs/RefControl.tsx","../src/presets/classic/components/refs/RefSocket.tsx","../src/presets/classic/components/Node.tsx","../src/presets/classic/components/Socket.tsx","../src/presets/classic/index.tsx","../src/presets/context-menu/hooks.ts","../src/presets/context-menu/vars.ts","../src/presets/context-menu/styles.ts","../src/presets/context-menu/components/Item.tsx","../src/presets/context-menu/components/Search.tsx","../src/presets/context-menu/components/Menu.tsx","../src/presets/context-menu/index.tsx","../node_modules/usehooks-ts/dist/esm/useElementSize/useElementSize.js","../node_modules/usehooks-ts/dist/esm/useEventListener/useEventListener.js","../node_modules/usehooks-ts/dist/esm/useIsomorphicLayoutEffect/useIsomorphicLayoutEffect.js","../src/presets/minimap/utils.ts","../src/presets/minimap/components/MiniNode.tsx","../src/presets/minimap/components/MiniViewport.tsx","../src/presets/minimap/components/Minimap.tsx","../src/presets/minimap/index.tsx","../src/presets/reroute-pins/Pin.tsx","../src/presets/reroute-pins/index.tsx","../src/index.tsx","../src/renderer.ts"],"sourcesContent":["import { useEffect, useRef, useState } from 'react'\r\nimport { flushSync } from 'react-dom'\r\n\r\nexport function Root({ children, rendered }: { children: JSX.Element | null, rendered: () => void }) {\r\n  useEffect(() => {\r\n    rendered()\r\n  })\r\n\r\n  return children\r\n}\r\n\r\nexport function syncFlush() {\r\n  const ready = useRef(false)\r\n\r\n  useEffect(() => {\r\n    ready.current = true\r\n  }, [])\r\n\r\n  return {\r\n    apply(f: () => void) {\r\n      if (ready.current) {\r\n        try {\r\n          flushSync(f)\r\n        } catch (error) {\r\n          const message = error ? (error as Error).message : null\r\n\r\n          if (message && (\r\n            message.includes('flushSync was called from inside a lifecycle method')\r\n            || message.includes('React error #187')\r\n          )) {\r\n            f()\r\n            return\r\n          }\r\n          throw error\r\n        }\r\n      } else {\r\n        f()\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function useRete<T extends { destroy(): void }>(create: (el: HTMLElement) => Promise<T>) {\r\n  const [container, setContainer] = useState<null | HTMLElement>(null)\r\n  const editorRef = useRef<T>()\r\n  const [editor, setEditor] = useState<T | null>(null)\r\n  const ref = useRef(null)\r\n\r\n  useEffect(() => {\r\n    if (container) {\r\n      if (editorRef.current) {\r\n        editorRef.current.destroy()\r\n        container.innerHTML = ''\r\n      }\r\n      create(container).then((value) => {\r\n        editorRef.current = value\r\n        setEditor(value)\r\n      })\r\n    }\r\n  }, [container, create])\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (editorRef.current) {\r\n        editorRef.current.destroy()\r\n      }\r\n    }\r\n  }, [])\r\n  useEffect(() => {\r\n    if (ref.current) {\r\n      setContainer(ref.current)\r\n    }\r\n  }, [ref.current])\r\n\r\n  return [ref, editor] as const\r\n}\r\n","import * as React from 'react'\r\nimport { createContext, useContext, useEffect, useState } from 'react'\r\n\r\nimport { Position } from '../../../types'\r\nimport { syncFlush } from '../../../utils'\r\n\r\nexport type ConnectionContextValue = { start: Position | null, end: Position | null, path: null | string }\r\n\r\nexport const ConnectionContext = createContext<ConnectionContextValue>({\r\n  start: null,\r\n  end: null,\r\n  path: null\r\n})\r\n\r\ntype PositionWatcher = (cb: (value: Position) => void) => (() => void)\r\n\r\ntype Props = {\r\n    children: JSX.Element,\r\n    start: Position | PositionWatcher,\r\n    end: Position | PositionWatcher,\r\n    path(start: Position, end: Position): Promise<null | string>\r\n}\r\n\r\nexport function ConnectionWrapper(props: Props) {\r\n  const { children } = props\r\n  const [computedStart, setStart] = useState<Position | null>(null)\r\n  const [computedEnd, setEnd] = useState<Position| null>(null)\r\n  const [path, setPath] = useState<string | null>(null)\r\n  const start = 'x' in props.start ? props.start : computedStart\r\n  const end = 'x' in props.end ? props.end : computedEnd\r\n  const flush = syncFlush()\r\n\r\n  useEffect(() => {\r\n    const unwatch1 = typeof props.start === 'function' && props.start(s => flush.apply(() => setStart(s)))\r\n    const unwatch2 = typeof props.end === 'function' && props.end(s => flush.apply(() => setEnd(s)))\r\n\r\n    return () => {\r\n      unwatch1 && unwatch1()\r\n      unwatch2 && unwatch2()\r\n    }\r\n  }, [])\r\n  useEffect(() => {\r\n    if (start && end) props.path(start, end).then(p => flush.apply(() => setPath(p)))\r\n  }, [start, end])\r\n\r\n  return (\r\n    <ConnectionContext.Provider value={{ start, end, path }}>\r\n      {children}\r\n    </ConnectionContext.Provider>\r\n  )\r\n}\r\n\r\nexport function useConnection() {\r\n  return useContext(ConnectionContext)\r\n}\r\n","import * as React from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { ClassicScheme } from '../types'\r\nimport { useConnection } from './ConnectionWrapper'\r\n\r\nconst Svg = styled.svg`\r\n    overflow: visible !important;\r\n    position: absolute;\r\n    pointer-events: none;\r\n    width: 9999px;\r\n    height: 9999px;\r\n`\r\n\r\nconst Path = styled.path<{ styles?: (props: any) => any }>`\r\n    fill: none;\r\n    stroke-width: 5px;\r\n    stroke: steelblue;\r\n    pointer-events: auto;\r\n    ${props => props.styles && props.styles(props)}\r\n`\r\n\r\nexport function Connection(props: { data: ClassicScheme['Connection'] & { isLoop?: boolean }, styles?: () => any }) {\r\n  const { path } = useConnection()\r\n\r\n  if (!path) return null\r\n\r\n  return (\r\n    <Svg data-testid=\"connection\">\r\n      <Path\r\n        styles={props.styles}\r\n        d={path} />\r\n    </Svg>\r\n  )\r\n}\r\n","export function copyEvent<T extends Event & Record<string, any>>(e: T) {\r\n  const newEvent = new (e.constructor as { new(type: string): T })(e.type)\r\n  let current = newEvent\r\n\r\n  while ((current = Object.getPrototypeOf(current))) {\r\n    const keys = Object.getOwnPropertyNames(current)\r\n\r\n    for (const k of keys) {\r\n      const item = newEvent[k]\r\n\r\n      if (typeof item === 'function') continue\r\n\r\n      Object.defineProperty(newEvent, k, { value: e[k] })\r\n    }\r\n  }\r\n\r\n  return newEvent\r\n}\r\n\r\nconst rootPrefix = '__reactContainer$'\r\n\r\ntype Keys = `${typeof rootPrefix}${string}` | '_reactRootContainer'\r\ntype ReactNode = { [key in Keys]?: unknown } & HTMLElement\r\n\r\nexport function findReactRoot(element: HTMLElement) {\r\n  let current: ReactNode | null = element as ReactNode\r\n\r\n  while (current) {\r\n    if (current._reactRootContainer || Object.keys(current).some(key => key.startsWith(rootPrefix))) return current\r\n    current = current.parentElement as ReactNode\r\n  }\r\n}\r\n","import * as React from 'react'\r\n\r\nimport { Position } from '../types'\r\nimport { copyEvent, findReactRoot } from './utils'\r\n\r\ntype Translate = (dx: number, dy: number) => void\r\ntype StartEvent = { pageX: number, pageY: number }\r\n\r\nexport function useDrag(translate: Translate, getPointer: (e: StartEvent) => Position) {\r\n  return {\r\n    start(e: StartEvent) {\r\n      let previous = { ...getPointer(e) }\r\n\r\n      function move(moveEvent: MouseEvent) {\r\n        const current = { ...getPointer(moveEvent) }\r\n        const dx = current.x - previous.x\r\n        const dy = current.y - previous.y\r\n\r\n        previous = current\r\n\r\n        translate(dx, dy)\r\n      }\r\n      function up() {\r\n        window.removeEventListener('pointermove', move)\r\n        window.removeEventListener('pointerup', up)\r\n        window.removeEventListener('pointercancel', up)\r\n      }\r\n\r\n      window.addEventListener('pointermove', move)\r\n      window.addEventListener('pointerup', up)\r\n      window.addEventListener('pointercancel', up)\r\n    }\r\n  }\r\n}\r\n\r\nexport function useNoDrag(ref: React.MutableRefObject<HTMLElement | null>, disabled?: boolean) {\r\n  React.useEffect(() => {\r\n    const handleClick = (e: PointerEvent) => {\r\n      if (disabled) return\r\n\r\n      const root = findReactRoot(e.target as HTMLElement)\r\n      const target = React.version.startsWith('16') ? document : root\r\n\r\n      if (target) {\r\n        e.stopPropagation()\r\n        target.dispatchEvent(copyEvent(e))\r\n      }\r\n    }\r\n    const el = ref.current\r\n\r\n    el?.addEventListener('pointerdown', handleClick)\r\n\r\n    return () => {\r\n      el?.removeEventListener('pointerdown', handleClick)\r\n    }\r\n  }, [ref, disabled])\r\n}\r\n\r\nexport function NoDrag(props: { children: React.ReactNode, disabled?: boolean }) {\r\n  const ref = React.useRef<HTMLDivElement | null>(null)\r\n\r\n  useNoDrag(ref, props.disabled)\r\n\r\n  return <span ref={ref}>{props.children}</span>\r\n}\r\n","import * as React from 'react'\r\nimport { ClassicPreset } from 'rete'\r\nimport styled from 'styled-components'\r\n\r\nimport { Drag } from '../../../shared'\r\n\r\nconst Input = styled.input<{ styles?: (props: any) => any }>`\r\n  width: 100%;\r\n  border-radius: 30px;\r\n  background-color: white;\r\n  padding: 2px 6px;\r\n  border: 1px solid #999;\r\n  font-size: 110%;\r\n  box-sizing: border-box;\r\n  ${props => props.styles && props.styles(props)}\r\n`\r\n\r\nexport function Control<N extends 'text' | 'number'>(props: { data: ClassicPreset.InputControl<N>, styles?: () => any }) {\r\n  const [value, setValue] = React.useState(props.data.value)\r\n  const ref = React.useRef(null)\r\n\r\n  Drag.useNoDrag(ref)\r\n\r\n  React.useEffect(() => {\r\n    setValue(props.data.value)\r\n  }, [props.data.value])\r\n\r\n  return (\r\n    <Input\r\n      value={value}\r\n      type={props.data.type}\r\n      ref={ref}\r\n      readOnly={props.data.readonly}\r\n      onChange={e => {\r\n        const val = (props.data.type === 'number'\r\n          ? +e.target.value\r\n          : e.target.value) as typeof props.data['value']\r\n\r\n        setValue(val)\r\n        props.data.setValue(val)\r\n      }}\r\n      styles={props.styles}\r\n    />\r\n  )\r\n}\r\n","export const $nodecolor = 'rgba(110,136,255,0.8)'\r\nexport const $nodecolorselected = '#ffd92c'\r\nexport const $socketsize = 24\r\nexport const $socketmargin = 6\r\nexport const $socketcolor = '#96b38a'\r\nexport const $nodewidth = 180\r\n","import * as React from 'react'\r\n\r\ntype RefUpdate = (ref: HTMLElement) => void\r\ntype BaseProps = { init: RefUpdate, unmount: RefUpdate } & Record<string, unknown>\r\n\r\n/**\r\n * Component for rendering various elements embedded in the React.js component tree.\r\n */\r\nexport function RefComponent<Props extends BaseProps>({ init, unmount, ...props }: Props) {\r\n  const ref = React.useRef<HTMLSpanElement>(null)\r\n\r\n  React.useEffect(() => {\r\n    const element = ref.current\r\n\r\n    return () => {\r\n      if (element) unmount(element)\r\n    }\r\n  }, [])\r\n  React.useEffect(() => {\r\n    if (ref.current) init(ref.current)\r\n  })\r\n\r\n  return <span {...props} ref={ref} />\r\n}\r\n","import * as React from 'react'\r\nimport { ClassicPreset } from 'rete'\r\n\r\nimport { RefComponent } from '../../../../ref-component'\r\nimport { ClassicScheme, GetControls, ReactArea2D } from '../../types'\r\n\r\ntype Props<Scheme extends ClassicScheme> = {\r\n  name: string\r\n  emit: (props: ReactArea2D<Scheme>) => void\r\n  payload: ClassicPreset.Control\r\n}\r\n\r\nexport function RefControl<Scheme extends ClassicScheme>({ name, emit, payload, ...props }: Props<Scheme>) {\r\n  return <RefComponent\r\n    {...props}\r\n    className={name}\r\n    init={ref => emit({ type: 'render', data: {\r\n      type: 'control',\r\n      element: ref,\r\n      payload: payload as GetControls<Scheme['Node']>\r\n    } })}\r\n    unmount={ref => emit({ type: 'unmount', data: { element: ref } })}\r\n  />\r\n}\r\n","import * as React from 'react'\r\nimport { ClassicPreset, NodeId } from 'rete'\r\n\r\nimport { RefComponent } from '../../../../ref-component'\r\nimport { ClassicScheme, GetSockets, ReactArea2D, Side } from '../../types'\r\n\r\ntype Props<Scheme extends ClassicScheme> = {\r\n  name: string\r\n  emit: (props: ReactArea2D<Scheme>) => void\r\n  side: Side\r\n  nodeId: NodeId\r\n  socketKey: string\r\n  payload: ClassicPreset.Socket\r\n}\r\n\r\nexport function RefSocket<Scheme extends ClassicScheme>({ name, emit, nodeId, side, socketKey, payload, ...props }: Props<Scheme>) {\r\n  return <RefComponent\r\n    {...props}\r\n    className={name}\r\n    init={ref => emit({ type: 'render', data: {\r\n      type: 'socket',\r\n      side,\r\n      key: socketKey,\r\n      nodeId,\r\n      element: ref,\r\n      payload: payload as GetSockets<Scheme['Node']>\r\n    } })}\r\n    unmount={ref => emit({ type: 'unmount', data: { element: ref } })}\r\n  />\r\n}\r\n","import * as React from 'react'\r\nimport styled, { css } from 'styled-components'\r\n\r\nimport { ClassicScheme, RenderEmit } from '../types'\r\nimport { $nodecolor, $nodecolorselected, $nodewidth, $socketmargin, $socketsize } from '../vars'\r\nimport { RefControl } from './refs/RefControl'\r\nimport { RefSocket } from './refs/RefSocket'\r\n\r\ntype NodeExtraData = { width?: number, height?: number }\r\n\r\nexport const NodeStyles = styled.div<NodeExtraData & { selected: boolean, styles?: (props: any) => any }>`\r\n    background: ${$nodecolor};\r\n    border: 2px solid #4e58bf;\r\n    border-radius: 10px;\r\n    cursor: pointer;\r\n    box-sizing: border-box;\r\n    width: ${props => Number.isFinite(props.width) ? `${props.width}px` : `${$nodewidth}px`};\r\n    height: ${props => Number.isFinite(props.height) ? `${props.height}px` : 'auto'};\r\n    padding-bottom: 6px;\r\n    position: relative;\r\n    user-select: none;\r\n    line-height: initial;\r\n    font-family: Arial;\r\n\r\n    &:hover {\r\n        background: lighten(${$nodecolor},4%);\r\n    }\r\n    ${props => props.selected && css`\r\n        background: ${$nodecolorselected};\r\n        border-color: #e3c000;\r\n    `}\r\n    .title {\r\n        color: white;\r\n        font-family: sans-serif;\r\n        font-size: 18px;\r\n        padding: 8px;\r\n    }\r\n    .output {\r\n        text-align: right;\r\n    }\r\n    .input {\r\n        text-align: left;\r\n    }\r\n    .output-socket {\r\n        text-align: right;\r\n        margin-right: -${$socketsize / 2 + $socketmargin}px;\r\n        display: inline-block;\r\n    }\r\n    .input-socket {\r\n        text-align: left;\r\n        margin-left: -${$socketsize / 2 + $socketmargin}px;\r\n        display: inline-block;\r\n    }\r\n    .input-title,.output-title {\r\n        vertical-align: middle;\r\n        color: white;\r\n        display: inline-block;\r\n        font-family: sans-serif;\r\n        font-size: 14px;\r\n        margin: ${$socketmargin}px;\r\n        line-height: ${$socketsize}px;\r\n    }\r\n    .input-control {\r\n        z-index: 1;\r\n        width: calc(100% - ${$socketsize + 2 * $socketmargin}px);\r\n        vertical-align: middle;\r\n        display: inline-block;\r\n    }\r\n    .control {\r\n        display: block;\r\n        padding: ${$socketmargin}px ${$socketsize / 2 + $socketmargin}px;\r\n    }\r\n    ${props => props.styles && props.styles(props)}\r\n`\r\n\r\nfunction sortByIndex<T extends [string, undefined | { index?: number }][]>(entries: T) {\r\n  entries.sort((a, b) => {\r\n    const ai = a[1]?.index || 0\r\n    const bi = b[1]?.index || 0\r\n\r\n    return ai - bi\r\n  })\r\n}\r\n\r\ntype Props<S extends ClassicScheme> = {\r\n    data: S['Node'] & NodeExtraData\r\n    styles?: () => any\r\n    emit: RenderEmit<S>\r\n}\r\nexport type NodeComponent<Scheme extends ClassicScheme> = (props: Props<Scheme>) => JSX.Element\r\n\r\n// eslint-disable-next-line max-statements\r\nexport function Node<Scheme extends ClassicScheme>(props: Props<Scheme>) {\r\n  const inputs = Object.entries(props.data.inputs)\r\n  const outputs = Object.entries(props.data.outputs)\r\n  const controls = Object.entries(props.data.controls)\r\n  const selected = props.data.selected || false\r\n  const { id, label, width, height } = props.data\r\n\r\n  sortByIndex(inputs)\r\n  sortByIndex(outputs)\r\n  sortByIndex(controls)\r\n\r\n  return (\r\n    <NodeStyles\r\n      selected={selected}\r\n      width={width}\r\n      height={height}\r\n      styles={props.styles}\r\n      data-testid=\"node\"\r\n    >\r\n      <div className=\"title\" data-testid=\"title\">{label}</div>\r\n      {/* Outputs */}\r\n      {outputs.map(([key, output]) => (\r\n        output && <div className=\"output\" key={key} data-testid={`output-${key}`}>\r\n          <div className=\"output-title\" data-testid=\"output-title\">{output?.label}</div>\r\n          <RefSocket\r\n            name=\"output-socket\"\r\n            side=\"output\"\r\n            socketKey={key}\r\n            nodeId={id}\r\n            emit={props.emit}\r\n            payload={output.socket}\r\n            data-testid=\"output-socket\"\r\n          />\r\n        </div>\r\n      ))}\r\n      {/* Controls */}\r\n      {controls.map(([key, control]) => {\r\n        return control ? <RefControl\r\n          key={key}\r\n          name=\"control\"\r\n          emit={props.emit}\r\n          payload={control}\r\n          data-testid={`control-${key}`}\r\n        /> : null\r\n      })}\r\n      {/* Inputs */}\r\n      {inputs.map(([key, input]) => (\r\n        input && <div className=\"input\" key={key} data-testid={`input-${key}`}>\r\n          <RefSocket\r\n            name=\"input-socket\"\r\n            side=\"input\"\r\n            socketKey={key}\r\n            nodeId={id}\r\n            emit={props.emit}\r\n            payload={input.socket}\r\n            data-testid=\"input-socket\"\r\n          />\r\n          {input && (!input.control || !input.showControl) && (\r\n            <div className=\"input-title\" data-testid=\"input-title\">{input?.label}</div>\r\n          )}\r\n          {input?.control && input?.showControl && (\r\n            <RefControl\r\n              key={key}\r\n              name=\"input-control\"\r\n              emit={props.emit}\r\n              payload={input.control}\r\n              data-testid=\"input-control\"\r\n            />\r\n          )\r\n          }\r\n        </div>\r\n      ))}\r\n    </NodeStyles>\r\n  )\r\n}\r\n","import * as React from 'react'\r\nimport { ClassicPreset } from 'rete'\r\nimport styled from 'styled-components'\r\n\r\nimport { $socketcolor, $socketmargin, $socketsize } from '../vars'\r\n\r\nconst Styles = styled.div`\r\n    display: inline-block;\r\n    cursor: pointer;\r\n    border: 1px solid white;\r\n    border-radius: ${$socketsize/2.0}px;\r\n    width: ${$socketsize}px;\r\n    height: ${$socketsize}px;\r\n    vertical-align: middle;\r\n    background: ${$socketcolor};\r\n    z-index: 2;\r\n    box-sizing: border-box;\r\n    &:hover {\r\n      border-width: 4px;\r\n    }\r\n    &.multiple {\r\n      border-color: yellow;\r\n    }\r\n`\r\n\r\nconst Hoverable = styled.div`\r\n    border-radius: ${($socketsize + $socketmargin * 2)/2.0}px;\r\n    padding: ${$socketmargin}px;\r\n    &:hover ${Styles} {\r\n      border-width: 4px;\r\n    }\r\n`\r\n\r\nexport function Socket<T extends ClassicPreset.Socket>(props: { data: T }) {\r\n  return (\r\n    <Hoverable>\r\n      <Styles title={props.data.name} />\r\n    </Hoverable>\r\n  )\r\n}\r\n","import * as React from 'react'\r\nimport { ClassicPreset, Scope } from 'rete'\r\nimport {\r\n  classicConnectionPath, getDOMSocketPosition,\r\n  loopConnectionPath, SocketPositionWatcher\r\n} from 'rete-render-utils'\r\n\r\nimport { Position } from '../../types'\r\nimport { RenderPreset } from '../types'\r\nimport { Connection } from './components/Connection'\r\nimport { ConnectionWrapper } from './components/ConnectionWrapper'\r\nimport { Control } from './components/Control'\r\nimport { Node } from './components/Node'\r\nimport { Socket } from './components/Socket'\r\nimport {\r\n  ClassicScheme, ExtractPayload, ReactArea2D, RenderEmit\r\n} from './types'\r\nimport { AcceptComponent } from './utility-types'\r\n\r\nexport { Connection } from './components/Connection'\r\nexport { useConnection } from './components/ConnectionWrapper'\r\nexport { Control } from './components/Control'\r\nexport { Control as InputControl } from './components/Control'\r\nexport { Node, NodeStyles } from './components/Node'\r\nexport { RefControl } from './components/refs/RefControl'\r\nexport { RefSocket } from './components/refs/RefSocket'\r\nexport { Socket } from './components/Socket'\r\nexport type { ClassicScheme, ReactArea2D, RenderEmit } from './types'\r\nexport * as vars from './vars'\r\n\r\ntype CustomizationProps<Schemes extends ClassicScheme> = {\r\n  node?: (data: ExtractPayload<Schemes, 'node'>) => AcceptComponent<typeof data['payload'], { emit: RenderEmit<Schemes> }> | null\r\n  connection?: (data: ExtractPayload<Schemes, 'connection'>) => AcceptComponent<typeof data['payload']> | null\r\n  socket?: (data: ExtractPayload<Schemes, 'socket'>) => AcceptComponent<typeof data['payload']> | null\r\n  control?: (data: ExtractPayload<Schemes, 'control'>) => AcceptComponent<typeof data['payload']> | null\r\n}\r\n\r\ntype ClassicProps<Schemes extends ClassicScheme, K> = {\r\n  socketPositionWatcher?: SocketPositionWatcher<Scope<never, [K]>>\r\n  customize?: CustomizationProps<Schemes>\r\n}\r\n\r\n/**\r\n * Classic preset for rendering nodes, connections, controls and sockets.\r\n */\r\nexport function setup<Schemes extends ClassicScheme, K extends ReactArea2D<Schemes>>(\r\n  props?: ClassicProps<Schemes, K>\r\n): RenderPreset<Schemes, K> {\r\n  const positionWatcher = typeof props?.socketPositionWatcher === 'undefined'\r\n    ? getDOMSocketPosition<Schemes, K>()\r\n    : props?.socketPositionWatcher\r\n  const { node, connection, socket, control } = props?.customize || {}\r\n\r\n  return {\r\n    attach(plugin) {\r\n      positionWatcher.attach(plugin as unknown as Scope<never, [K]>)\r\n    },\r\n    // eslint-disable-next-line max-statements, complexity\r\n    render(context, plugin) {\r\n      if (context.data.type === 'node') {\r\n        const parent = plugin.parentScope()\r\n        const Component = (node ? node(context.data) : Node) as typeof Node\r\n\r\n        return (Component &&\r\n          <Component\r\n            data={context.data.payload}\r\n            emit={data => parent.emit(data as any)}\r\n          />\r\n        )\r\n      } else if (context.data.type === 'connection') {\r\n        const Component = (connection ? connection(context.data) : Connection) as typeof Connection\r\n        const payload = context.data.payload\r\n        const { sourceOutput, targetInput, source, target } = payload\r\n\r\n        return (Component &&\r\n          <ConnectionWrapper\r\n            start={context.data.start || (change => positionWatcher.listen(source, 'output', sourceOutput, change))}\r\n            end={context.data.end || (change => positionWatcher.listen(target, 'input', targetInput, change))}\r\n            path={async (start, end) => {\r\n              type FixImplicitAny = typeof plugin.__scope.produces | undefined\r\n              const response: FixImplicitAny = await plugin.emit({\r\n                type: 'connectionpath', data: {\r\n                  payload,\r\n                  points: [start, end]\r\n                }\r\n              })\r\n\r\n              if (!response) return ''\r\n\r\n              const { path, points } = response.data\r\n              const curvature = 0.3\r\n\r\n              if (!path && points.length !== 2) throw new Error('cannot render connection with a custom number of points')\r\n              if (!path) return payload.isLoop\r\n                ? loopConnectionPath(points as [Position, Position], curvature, 120)\r\n                : classicConnectionPath(points as [Position, Position], curvature)\r\n\r\n              return path\r\n            }}\r\n          >\r\n            <Component data={context.data.payload} />\r\n          </ConnectionWrapper>\r\n        )\r\n      } else if (context.data.type === 'socket') {\r\n        const Component = (socket ? socket(context.data) : Socket) as typeof Socket\r\n\r\n        return (Component && context.data.payload && <Component data={context.data.payload} />\r\n        )\r\n      } else if (context.data.type === 'control') {\r\n        const Component = control && context.data.payload\r\n          ? control(context.data)\r\n          : (\r\n            context.data.payload instanceof ClassicPreset.InputControl\r\n              ? Control\r\n              : null\r\n          )\r\n\r\n        return Component && <Component data={context.data.payload as any} />\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { useEffect, useRef } from 'react'\r\n\r\nexport function useDebounce(cb: () => void, timeout: number): [null | (() => void), () => void] {\r\n  const ref = useRef<ReturnType<typeof setTimeout>>()\r\n\r\n  function cancel() {\r\n    ref.current && clearTimeout(ref.current)\r\n  }\r\n  const func = () => {\r\n    cancel()\r\n\r\n    ref.current = setTimeout(() => {\r\n      cb()\r\n    }, timeout)\r\n  }\r\n\r\n  useEffect(() => cancel, [])\r\n\r\n  return [\r\n    func,\r\n    cancel\r\n  ]\r\n}\r\n","\r\nexport const $contextColor = 'rgba(110,136,255,0.8)'\r\nexport const $contextColorLight = 'rgba(130, 153, 255, 0.8)'\r\nexport const $contextColorDark = 'rgba(69, 103, 255, 0.8)'\r\nexport const $contextMenuRound = '5px'\r\nexport const $width = 120\r\n","import styled from 'styled-components'\r\n\r\nimport { $contextColor, $contextColorDark, $contextColorLight, $contextMenuRound } from './vars'\r\n\r\nexport const CommonStyle = styled.div`\r\n  color: #fff;\r\n  padding: 4px;\r\n  border-bottom: 1px solid ${$contextColorDark};\r\n  background-color: ${$contextColor};\r\n  cursor: pointer;\r\n  width: 100%;\r\n  position: relative;\r\n  &:first-child {\r\n    border-top-left-radius: ${$contextMenuRound};\r\n    border-top-right-radius: ${$contextMenuRound};\r\n  }\r\n  &:last-child {\r\n    border-bottom-left-radius: ${$contextMenuRound};\r\n    border-bottom-right-radius: ${$contextMenuRound};\r\n  }\r\n  &:hover {\r\n    background-color: ${$contextColorLight};\r\n  }\r\n`\r\n","import * as React from 'react'\r\nimport styled, { css } from 'styled-components'\r\n\r\nimport { useDebounce } from '../hooks'\r\nimport { CommonStyle } from '../styles'\r\nimport { Customize, Item } from '../types'\r\nimport { $width } from '../vars'\r\n\r\nexport const ItemStyle = styled(CommonStyle) <{ hasSubitems?: boolean }>`\r\n    ${props => props.hasSubitems && css`&:after {\r\n    content: 'â–º';\r\n    position: absolute;\r\n    opacity: 0.6;\r\n    right: 5px;\r\n    top: 5px;\r\n    }`}\r\n`\r\n\r\nexport const SubitemStyles = styled.div`\r\n    position: absolute;\r\n    top: 0;\r\n    left: 100%;\r\n    width: ${$width}px;\r\n`\r\n\r\ntype Props = {\r\n  data: Item\r\n  delay: number\r\n  hide(): void\r\n  children: React.ReactNode\r\n  components?: Pick<Customize, 'item' | 'subitems'>\r\n}\r\n\r\nexport function ItemElement(props: Props) {\r\n  const [visibleSubitems, setVisibleSubitems] = React.useState(false)\r\n  const setInvisibile = React.useCallback(() => setVisibleSubitems(false), [setVisibleSubitems])\r\n  const [hide, cancelHide] = useDebounce(setInvisibile, props.delay)\r\n  const Component = props.components?.item?.(props.data) || ItemStyle\r\n  const Subitems = props.components?.subitems?.(props.data) || SubitemStyles\r\n\r\n  return <Component\r\n    onClick={e => { e.stopPropagation(); props.data.handler(); props.hide() }}\r\n    hasSubitems={Boolean(props.data.subitems)}\r\n    onPointerDown={e => e.stopPropagation()}\r\n    onPointerOver={() => { cancelHide(); setVisibleSubitems(true) }}\r\n    onPointerLeave={() => hide && hide()}\r\n    data-testid=\"context-menu-item\"\r\n  >\r\n    {props.children}\r\n    {props.data.subitems && visibleSubitems && (\r\n      <Subitems>\r\n        {props.data.subitems.map(item => (\r\n          <ItemElement\r\n            key={item.key}\r\n            data={item}\r\n            delay={props.delay}\r\n            hide={props.hide}\r\n            components={props.components}\r\n          >{item.label}</ItemElement>\r\n        ))}\r\n      </Subitems>\r\n    )}\r\n  </Component>\r\n}\r\n","import * as React from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { ComponentType } from '../types'\r\n\r\nexport const SearchInput = styled.input`\r\n  color: white;\r\n  padding: 1px 8px;\r\n  border: 1px solid white;\r\n  border-radius: 10px;\r\n  font-size: 16px;\r\n  font-family: serif;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n  background: transparent;\r\n`\r\n\r\nexport function Search(props: { value: string, onChange(value: string): void, component?: ComponentType }) {\r\n  const Component = props.component || SearchInput\r\n\r\n  return (\r\n    <Component\r\n      value={props.value}\r\n      onInput={e => props.onChange((e.target as HTMLInputElement).value)}\r\n      onPointerDown={e => e.stopPropagation()}\r\n      data-testid=\"context-menu-search-input\"\r\n    />\r\n  )\r\n}\r\n","import * as React from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { useDebounce } from '../hooks'\r\nimport { CommonStyle } from '../styles'\r\nimport { Customize, Item } from '../types'\r\nimport { $width } from '../vars'\r\nimport { ItemElement } from './Item'\r\nimport { Search } from './Search'\r\n\r\nexport const Styles = styled.div`\r\n  padding: 10px;\r\n  width: ${$width}px;\r\n  margin-top: -20px;\r\n  margin-left: -${$width / 2}px;\r\n`\r\n\r\ntype Props = {\r\n  items: Item[]\r\n  delay: number\r\n  searchBar?: boolean\r\n  onHide(): void\r\n  components?: Customize\r\n}\r\n\r\nexport function Menu(props: Props) {\r\n  const [hide, cancelHide] = useDebounce(props.onHide, props.delay)\r\n  const [filter, setFilter] = React.useState('')\r\n  const filterRegexp = new RegExp(filter, 'i')\r\n  const filteredList = props.items.filter(item => (\r\n    item.label.match(filterRegexp)\r\n  ))\r\n  const Component = props.components?.main?.() || Styles\r\n  const Common = props.components?.common?.() || CommonStyle\r\n\r\n  return <Component\r\n    onMouseOver={() => cancelHide()}\r\n    onMouseLeave={() => hide && hide()}\r\n    onWheel={e => e.stopPropagation()}\r\n    data-testid=\"context-menu\"\r\n  >\r\n    {props.searchBar && (\r\n      <Common>\r\n        <Search value={filter} onChange={setFilter} component={props.components?.search?.()} />\r\n      </Common>\r\n    )}\r\n    {filteredList.map(item => {\r\n      return <ItemElement\r\n        key={item.key}\r\n        data={item}\r\n        delay={props.delay}\r\n        hide={props.onHide}\r\n        components={props.components}\r\n      >\r\n        {item.label}\r\n      </ItemElement>\r\n    })}\r\n  </Component>\r\n}\r\n","\r\nimport * as React from 'react'\r\nimport { BaseSchemes } from 'rete'\r\n\r\nimport { RenderPreset } from '../types'\r\nimport { Menu } from './components/Menu'\r\nimport { ContextMenuRender, Customize } from './types'\r\n\r\nexport { ItemStyle as Item, SubitemStyles as Subitems } from './components/Item'\r\nexport { Styles as Menu } from './components/Menu'\r\nexport { SearchInput as Search } from './components/Search'\r\nexport { CommonStyle as Common } from './styles'\r\n\r\ntype Props = {\r\n  delay?: number\r\n  customize?: Customize\r\n}\r\n\r\n/**\r\n * Preset for rendering context menu.\r\n */\r\nexport function setup<Schemes extends BaseSchemes, K extends ContextMenuRender>(props?: Props): RenderPreset<Schemes, K> {\r\n  const delay = typeof props?.delay === 'undefined' ? 1000 : props.delay\r\n\r\n  return {\r\n    render(context) {\r\n      if (context.data.type === 'contextmenu') {\r\n        return <Menu\r\n          items={context.data.items}\r\n          delay={delay}\r\n          searchBar={context.data.searchBar}\r\n          onHide={context.data.onHide}\r\n          components={props?.customize}\r\n        />\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { useCallback, useState } from 'react';\nimport { useEventListener, useIsomorphicLayoutEffect } from '..';\nfunction useElementSize() {\n    const [ref, setRef] = useState(null);\n    const [size, setSize] = useState({\n        width: 0,\n        height: 0,\n    });\n    const handleSize = useCallback(() => {\n        setSize({\n            width: (ref === null || ref === void 0 ? void 0 : ref.offsetWidth) || 0,\n            height: (ref === null || ref === void 0 ? void 0 : ref.offsetHeight) || 0,\n        });\n    }, [ref === null || ref === void 0 ? void 0 : ref.offsetHeight, ref === null || ref === void 0 ? void 0 : ref.offsetWidth]);\n    useEventListener('resize', handleSize);\n    useIsomorphicLayoutEffect(() => {\n        handleSize();\n    }, [ref === null || ref === void 0 ? void 0 : ref.offsetHeight, ref === null || ref === void 0 ? void 0 : ref.offsetWidth]);\n    return [setRef, size];\n}\nexport default useElementSize;\n","import { useEffect, useRef } from 'react';\nimport { useIsomorphicLayoutEffect } from '..';\nfunction useEventListener(eventName, handler, element, options) {\n    const savedHandler = useRef(handler);\n    useIsomorphicLayoutEffect(() => {\n        savedHandler.current = handler;\n    }, [handler]);\n    useEffect(() => {\n        var _a;\n        const targetElement = (_a = element === null || element === void 0 ? void 0 : element.current) !== null && _a !== void 0 ? _a : window;\n        if (!(targetElement && targetElement.addEventListener))\n            return;\n        const listener = event => savedHandler.current(event);\n        targetElement.addEventListener(eventName, listener, options);\n        return () => {\n            targetElement.removeEventListener(eventName, listener, options);\n        };\n    }, [eventName, element, options]);\n}\nexport default useEventListener;\n","import { useEffect, useLayoutEffect } from 'react';\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\nexport default useIsomorphicLayoutEffect;\n","export function px(value: number) {\r\n  return `${value}px`\r\n}\r\n","import * as React from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { px } from '../utils'\r\n\r\nconst Styles = styled.div`\r\n    position: absolute;\r\n    background: #7C43C5;\r\n    border: 1px solid #7C43C5;\r\n`\r\n\r\nexport function MiniNode(props: { left: number, top: number, width: number, height: number }) {\r\n  return <Styles style={{\r\n    left: px(props.left),\r\n    top: px(props.top),\r\n    width: px(props.width),\r\n    height: px(props.height)\r\n  }}\r\n    className='minimap-node'\r\n    data-testid=\"minimap-node\" />\r\n}\r\n","import * as React from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { useDrag } from '../../../shared/drag'\r\nimport { Rect, Transform, Translate } from '../types'\r\nimport { px } from '../utils'\r\n\r\nconst MiniViewportStyles = styled.div`\r\n  position: absolute;\r\n  background: #090E2CCC;\r\n  border: 1px solid #121D64;\r\n`\r\n\r\nexport function MiniViewport(props: Rect & { containerWidth: number, start(): Transform, translate: Translate }) {\r\n  const scale = (v: number) => v * props.containerWidth\r\n  const invert = (v: number) => v / props.containerWidth\r\n  const drag = useDrag((dx, dy) => props.translate(invert(-dx), invert(-dy)), e => ({ x: e.pageX, y: e.pageY }))\r\n\r\n  return <MiniViewportStyles\r\n    id='minimap-viewport'\r\n    onPointerDown={drag.start}\r\n    style={{\r\n      left: px(scale(props.left)),\r\n      top: px(scale(props.top)),\r\n      width: px(scale(props.width)),\r\n      height: px(scale(props.height))\r\n    }}\r\n    data-testid=\"minimap-viewport\"\r\n  />\r\n}\r\n","import * as React from 'react'\r\nimport { useCallback, useRef } from 'react'\r\nimport styled from 'styled-components'\r\nimport { useElementSize } from 'usehooks-ts'\r\n\r\nimport { Rect, Transform, Translate } from '../types'\r\nimport { px } from '../utils'\r\nimport { MiniNode } from './MiniNode'\r\nimport { MiniViewport } from './MiniViewport'\r\n\r\nconst Styles = styled.div<{ size: number }>`\r\n    position: absolute;\r\n    right: 24px;\r\n    bottom: 24px;\r\n    background: #010418;\r\n    padding: 20px;\r\n    overflow: hidden;\r\n    border: 2px solid #3C2857;\r\n    border-radius: 8px;\r\n    box-sizing: border-box;\r\n    transform: translateX(-175%);\r\n    transition: transform 0.5s ease;\r\n`\r\n\r\ntype Props = {\r\n  size: number\r\n  ratio: number\r\n  nodes: Rect[]\r\n  viewport: Rect\r\n  start(): Transform\r\n  translate: Translate\r\n  point(x: number, y: number): void\r\n}\r\n\r\nexport function Minimap(props: Props) {\r\n  const container = useRef<HTMLElement | null>()\r\n  const [containerRef, { width: containerWidth }] = useElementSize()\r\n  const scale = (v: number) => v * containerWidth\r\n\r\n  const ref = useCallback((node: HTMLDivElement | null) => {\r\n    container.current = node\r\n    containerRef(node)\r\n  }, [containerRef])\r\n\r\n  return <Styles\r\n    size={props.size}\r\n    id='minimap'\r\n    style={{\r\n      width: px(props.size * props.ratio),\r\n      height: px(props.size)\r\n    }}\r\n    onPointerDown={e => {\r\n      e.stopPropagation()\r\n      e.preventDefault()\r\n    }}\r\n    onDoubleClick={e => {\r\n      e.stopPropagation()\r\n      e.preventDefault()\r\n      if (!container.current) return\r\n      const box = container.current.getBoundingClientRect()\r\n      const x = (e.clientX - box.left) / (props.size * props.ratio)\r\n      const y = (e.clientY - box.top) / (props.size * props.ratio)\r\n\r\n      props.point(x, y)\r\n    }}\r\n    ref={ref}\r\n    data-testid=\"minimap\"\r\n  >\r\n    {containerWidth && props.nodes.map((node, i) => (\r\n      <MiniNode\r\n        key={i}\r\n        left={scale(node.left)}\r\n        top={scale(node.top)}\r\n        width={scale(node.width)}\r\n        height={scale(node.height)}\r\n      />\r\n    ))}\r\n    <MiniViewport\r\n      {...props.viewport}\r\n      start={props.start}\r\n      containerWidth={containerWidth}\r\n      translate={props.translate}\r\n    />\r\n  </Styles>\r\n}\r\n","\r\nimport * as React from 'react'\r\nimport { BaseSchemes } from 'rete'\r\n\r\nimport { RenderPreset } from '../types'\r\nimport { Minimap } from './components/Minimap'\r\nimport { MinimapRender } from './types'\r\n\r\n/**\r\n * Preset for rendering minimap.\r\n */\r\nexport function setup<Schemes extends BaseSchemes, K extends MinimapRender>(props?: { size?: number }): RenderPreset<Schemes, K> {\r\n  return {\r\n    render(context) {\r\n      if (context.data.type === 'minimap') {\r\n        return <Minimap\r\n          nodes={context.data.nodes}\r\n          size={props?.size || 200}\r\n          ratio={context.data.ratio}\r\n          viewport={context.data.viewport}\r\n          start={context.data.start}\r\n          translate={context.data.translate}\r\n          point={context.data.point}\r\n        />\r\n      }\r\n    }\r\n  }\r\n}\r\n","import * as React from 'react'\r\nimport styled, { } from 'styled-components'\r\n\r\nimport { useDrag } from '../../shared/drag'\r\nimport { Position } from '../../types'\r\nimport { Pin as PinType } from './types'\r\n\r\nconst pinSize = 20\r\n\r\nconst Styles = styled.div<{ selected?: boolean }>`\r\n  width: ${pinSize}px;\r\n  height: ${pinSize}px;\r\n  box-sizing: border-box;\r\n  background: ${props => props.selected ? '#ffd92c' : 'steelblue'};\r\n  border: 2px solid white;\r\n  border-radius: ${pinSize}px;\r\n`\r\n\r\ntype Props = PinType & {\r\n    contextMenu(): void\r\n    translate(dx: number, dy: number): void\r\n    pointerdown(): void\r\n    pointer(): Position\r\n}\r\n\r\nexport function Pin(props: Props) {\r\n  const drag = useDrag((dx, dy) => props.translate(dx, dy), props.pointer)\r\n  const { x, y } = props.position\r\n\r\n  return (\r\n    <Styles\r\n      onPointerDown={e => {\r\n        e.stopPropagation()\r\n        e.preventDefault()\r\n        drag.start(e)\r\n        props.pointerdown()\r\n      }}\r\n      onContextMenu={e => {\r\n        e.stopPropagation()\r\n        e.preventDefault()\r\n        props.contextMenu()\r\n      }}\r\n      selected={props.selected}\r\n      style={{ position: 'absolute', top: `${y - pinSize / 2}px`, left: `${x - pinSize / 2}px` }}\r\n      data-testid=\"pin\"\r\n    >\r\n\r\n    </Styles>\r\n  )\r\n}\r\n","\r\nimport * as React from 'react'\r\nimport { BaseSchemes } from 'rete'\r\nimport { BaseAreaPlugin } from 'rete-area-plugin'\r\n\r\nimport { Position } from '../../types'\r\nimport { RenderPreset } from '../types'\r\nimport { Pin } from './Pin'\r\nimport { PinData, PinsRender } from './types'\r\n\r\ntype Props = {\r\n  translate?: (id: string, dx: number, dy: number) => void\r\n  contextMenu?: (id: string) => void\r\n  pointerdown?: (id: string) => void\r\n}\r\n\r\n/**\r\n * Preset for rendering pins.\r\n */\r\nexport function setup<Schemes extends BaseSchemes, K extends PinsRender>(props?: Props): RenderPreset<Schemes, K> {\r\n  function renderPins(data: PinData, pointer: () => Position) {\r\n    return <>\r\n      {data.pins.map(pin => (\r\n        <Pin\r\n          {...pin}\r\n          key={pin.id}\r\n          contextMenu={() => props?.contextMenu && props.contextMenu(pin.id)}\r\n          translate={(dx, dy) => props?.translate && props.translate(pin.id, dx, dy)}\r\n          pointerdown={() => props?.pointerdown && props.pointerdown(pin.id)}\r\n          pointer={pointer}\r\n        />\r\n      ))}\r\n    </>\r\n  }\r\n\r\n  return {\r\n    render(context, plugin) {\r\n      const data = context.data\r\n      const area = plugin.parentScope<BaseAreaPlugin<Schemes, PinsRender>>(BaseAreaPlugin)\r\n\r\n      if (data.type === 'reroute-pins') {\r\n        return renderPins(data.data, () => area.area.pointer)\r\n      }\r\n    }\r\n  }\r\n}\r\n","import * as React from 'react'\r\nimport { BaseSchemes, CanAssignSignal, Scope } from 'rete'\r\n\r\nimport { RenderPreset } from './presets/types'\r\nimport { getRenderer, Renderer } from './renderer'\r\nimport { Position, RenderSignal } from './types'\r\nimport { Root } from './utils'\r\n\r\nexport * as Presets from './presets'\r\nexport type { ClassicScheme, ReactArea2D, RenderEmit } from './presets/classic'\r\nexport { RefComponent } from './ref-component'\r\nexport * from './shared'\r\nexport * from './types'\r\nexport { useRete } from './utils'\r\n\r\n/**\r\n * Signals that can be emitted by the plugin\r\n * @priority 9\r\n */\r\nexport type Produces<Schemes extends BaseSchemes> =\r\n  | { type: 'connectionpath', data: { payload: Schemes['Connection'], path?: string, points: Position[] } }\r\n\r\ntype Requires<Schemes extends BaseSchemes> =\r\n  | RenderSignal<'node', { payload: Schemes['Node'] }>\r\n  | RenderSignal<'connection', { payload: Schemes['Connection'], start?: Position, end?: Position }>\r\n  | { type: 'unmount', data: { element: HTMLElement } }\r\n\r\n/**\r\n * Plugin props\r\n */\r\nexport type Props = {\r\n  /** root factory for React.js 18+ */\r\n  createRoot?: (container: Element | DocumentFragment) => any\r\n}\r\n\r\n/**\r\n * React plugin. Renders nodes, connections and other elements using React.\r\n * @priority 10\r\n * @emits connectionpath\r\n * @listens render\r\n * @listens unmount\r\n */\r\nexport class ReactPlugin<Schemes extends BaseSchemes, T = Requires<Schemes>> extends Scope<Produces<Schemes>, [Requires<Schemes> | T]> {\r\n  renderer: Renderer\r\n  presets: RenderPreset<Schemes, T>[] = []\r\n\r\n  constructor(props?: Props) {\r\n    super('react-render')\r\n    this.renderer = getRenderer({ createRoot: props?.createRoot })\r\n\r\n    this.addPipe(context => {\r\n      if (!context || typeof context !== 'object' || !('type' in context)) return context\r\n      if (context.type === 'unmount') {\r\n        this.unmount(context.data.element)\r\n      } else if (context.type === 'render') {\r\n        if ('filled' in context.data && context.data.filled) {\r\n          return context\r\n        }\r\n        if (this.mount(context.data.element, context)) {\r\n          return {\r\n            ...context,\r\n            data: {\r\n              ...context.data,\r\n              filled: true\r\n            }\r\n          } as typeof context\r\n        }\r\n      }\r\n\r\n      return context\r\n    })\r\n  }\r\n\r\n  setParent(scope: Scope<Requires<Schemes> | T>): void {\r\n    super.setParent(scope)\r\n\r\n    this.presets.forEach(preset => {\r\n      if (preset.attach) preset.attach(this)\r\n    })\r\n  }\r\n\r\n  private mount(element: HTMLElement, context: Requires<Schemes>) {\r\n    const parent = this.parentScope()\r\n\r\n    for (const preset of this.presets) {\r\n      const result = preset.render(context as any, this)\r\n\r\n      if (!result) continue\r\n\r\n      const reactElement = (\r\n        <Root rendered={() => parent.emit({ type: 'rendered', data: context.data } as T)}>\r\n          {result}\r\n        </Root>\r\n      )\r\n\r\n      this.renderer.mount(reactElement, element)\r\n      return true\r\n    }\r\n  }\r\n\r\n  private unmount(element: HTMLElement) {\r\n    this.renderer.unmount(element)\r\n  }\r\n\r\n  /**\r\n   * Adds a preset to the plugin.\r\n   * @param preset Preset that can render nodes, connections and other elements.\r\n   */\r\n  public addPreset<K>(preset: RenderPreset<Schemes, CanAssignSignal<T, K> extends true ? K : 'Cannot apply preset. Provided signals are not compatible'>) {\r\n    const local = preset as RenderPreset<Schemes, T>\r\n\r\n    if (local.attach) local.attach(this)\r\n    this.presets.push(local)\r\n  }\r\n}\r\n","import * as ReactDOM from 'react-dom'\r\n\r\nexport type Renderer = { mount: ReactDOM.Renderer, unmount: (container: HTMLElement) => void }\r\n\r\ntype CreateRoot = (container: Element | DocumentFragment) => any\r\n\r\nexport function getRenderer(props?: { createRoot?: CreateRoot }): Renderer {\r\n  const createRoot = props?.createRoot\r\n\r\n  if (createRoot) {\r\n    const roots = new WeakMap<HTMLElement, any>()\r\n\r\n    return {\r\n      mount: ((\r\n        element: React.DOMElement<React.DOMAttributes<any>, any>,\r\n        container: HTMLElement\r\n      ) : Element => {\r\n        if (!roots.has(container)) {\r\n          roots.set(container, createRoot(container))\r\n        }\r\n        const root = roots.get(container)\r\n\r\n        return root.render(element)\r\n      }) as ReactDOM.Renderer,\r\n      unmount: (container: HTMLElement) => {\r\n        const root = roots.get(container)\r\n\r\n        if (root) {\r\n          root.unmount()\r\n          roots.delete(container)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    mount: ReactDOM.render,\r\n    unmount: ReactDOM.unmountComponentAtNode\r\n  }\r\n}\r\n"],"names":["Root","_ref","children","rendered","useEffect","ConnectionContext","createContext","start","end","path","ConnectionWrapper","props","ready","_useState2","_slicedToArray","useState","computedStart","setStart","_useState4","computedEnd","setEnd","_useState6","setPath","flush","useRef","current","apply","f","flushSync","error","message","includes","unwatch1","s","unwatch2","then","p","React","createElement","Provider","value","useConnection","useContext","Svg","styled","svg","_templateObject","_taggedTemplateLiteral","Path","_templateObject2","styles","Connection","d","rootPrefix","useDrag","translate","getPointer","e","previous","_objectSpread","move","moveEvent","dx","x","dy","y","up","window","removeEventListener","addEventListener","useNoDrag","ref","disabled","handleClick","root","element","_reactRootContainer","Object","keys","some","key","startsWith","parentElement","findReactRoot","target","version","document","stopPropagation","dispatchEvent","newEvent","constructor","type","getPrototypeOf","_step","_iterator","_createForOfIteratorHelper","getOwnPropertyNames","n","done","k","defineProperty","err","copyEvent","el","Input","input","Control","_React$useState2","data","setValue","Drag","readOnly","readonly","onChange","val","$nodecolor","$nodecolorselected","$socketsize","$socketcolor","RefComponent","init","unmount","_objectWithoutProperties","_excluded","_extends","RefControl","name","emit","payload","className","RefSocket","nodeId","side","socketKey","NodeStyles","div","Number","isFinite","width","concat","height","selected","css","sortByIndex","entries","sort","a","b","_a$","_b$","index","Node","inputs","outputs","controls","_props$data","id","label","map","_ref2","output","socket","_ref3","_ref4","control","_ref5","_ref6","showControl","Styles","Hoverable","Socket","title","positionWatcher","socketPositionWatcher","getDOMSocketPosition","customize","node","connection","attach","plugin","render","context","parent","parentScope","Component","sourceOutput","targetInput","source","change","listen","_regeneratorRuntime","mark","_callee","response","_response$data","points","curvature","wrap","_context","prev","next","sent","abrupt","length","Error","isLoop","loopConnectionPath","classicConnectionPath","stop","_x","_x2","this","arguments","_Component","_Component2","ClassicPreset","InputControl","_Component3","useDebounce","cb","timeout","cancel","clearTimeout","setTimeout","$contextMenuRound","CommonStyle","ItemStyle","hasSubitems","SubitemStyles","_templateObject3","ItemElement","_props$components","_props$components$ite","_props$components2","_props$components2$su","visibleSubitems","setVisibleSubitems","_useDebounce2","useCallback","delay","hide","cancelHide","components","item","call","Subitems","subitems","onClick","handler","Boolean","onPointerDown","onPointerOver","onPointerLeave","SearchInput","Search","component","onInput","$width","Menu","_props$components$mai","_props$components2$co","_props$components3","_props$components3$se","onHide","filter","setFilter","filterRegexp","RegExp","filteredList","items","match","main","Common","common","onMouseOver","onMouseLeave","onWheel","searchBar","search","useElementSize","setRef","size","setSize","handleSize","offsetWidth","offsetHeight","eventName","options","savedHandler","useIsomorphicLayoutEffect","_a","targetElement","listener","event","useEventListener","useLayoutEffect","px","MiniNode","style","left","top","MiniViewportStyles","MiniViewport","scale","v","containerWidth","invert","drag","pageX","pageY","Minimap","container","_useElementSize2","containerRef","ratio","preventDefault","onDoubleClick","box","getBoundingClientRect","clientX","clientY","point","nodes","i","viewport","pinSize","Pin","pointer","_props$position","position","pointerdown","onContextMenu","contextMenu","area","BaseAreaPlugin","Fragment","pins","pin","renderPins","ReactPlugin","_Scope","_inherits","_super","_createSuper","_this","_classCallCheck","_defineProperty","_assertThisInitialized","renderer","createRoot","roots","WeakMap","mount","has","set","get","ReactDOM","unmountComponentAtNode","getRenderer","addPipe","_typeof","filled","scope","_this2","_get","_getPrototypeOf","prototype","presets","forEach","preset","result","reactElement","local","push","Scope","create","setContainer","editorRef","editor","setEditor","destroy","innerHTML"],"mappings":"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"}