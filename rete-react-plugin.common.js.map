{"version":3,"file":"rete-react-plugin.common.js","sources":["../src/renderer.ts","../src/utils.ts","../src/presets/classic/components/ConnectionWrapper.tsx","../src/presets/classic/components/Connection.tsx","../src/shared/utils.ts","../src/shared/drag.tsx","../src/presets/classic/components/Control.tsx","../src/presets/classic/vars.ts","../src/ref-component.tsx","../src/presets/classic/components/refs/RefControl.tsx","../src/presets/classic/components/refs/RefSocket.tsx","../src/presets/classic/components/Node.tsx","../src/presets/classic/components/Socket.tsx","../src/presets/classic/index.tsx","../src/presets/context-menu/hooks.ts","../src/presets/context-menu/vars.ts","../src/presets/context-menu/styles.ts","../src/presets/context-menu/components/Item.tsx","../src/presets/context-menu/components/Search.tsx","../src/presets/context-menu/components/Menu.tsx","../src/presets/context-menu/index.tsx","../node_modules/usehooks-ts/dist/esm/useCopyToClipboard/useCopyToClipboard.js","../node_modules/usehooks-ts/dist/esm/useElementSize/useElementSize.js","../node_modules/usehooks-ts/dist/esm/useEventListener/useEventListener.js","../node_modules/usehooks-ts/dist/esm/useFetch/useFetch.js","../node_modules/usehooks-ts/dist/esm/useIsomorphicLayoutEffect/useIsomorphicLayoutEffect.js","../src/presets/minimap/utils.ts","../src/presets/minimap/components/MiniNode.tsx","../src/presets/minimap/components/MiniViewport.tsx","../src/presets/minimap/components/Minimap.tsx","../src/presets/minimap/index.tsx","../src/presets/reroute-pins/Pin.tsx","../src/presets/reroute-pins/index.tsx","../src/presets/index.ts","../src/index.tsx"],"sourcesContent":["import * as ReactDOM from 'react-dom'\r\n\r\nexport type Renderer = { mount: ReactDOM.Renderer, unmount: (container: HTMLElement) => void }\r\n\r\ntype CreateRoot = (container: Element | DocumentFragment) => any\r\n\r\nexport function getRenderer(props?: { createRoot?: CreateRoot }): Renderer {\r\n  const createRoot = props?.createRoot\r\n\r\n  if (createRoot) {\r\n    const roots = new WeakMap<HTMLElement, any>()\r\n\r\n    return {\r\n      mount: ((\r\n        element: React.DOMElement<React.DOMAttributes<any>, any>,\r\n        container: HTMLElement\r\n      ) : Element => {\r\n        if (!roots.has(container)) {\r\n          roots.set(container, createRoot(container))\r\n        }\r\n        const root = roots.get(container)\r\n\r\n        return root.render(element)\r\n      }) as ReactDOM.Renderer,\r\n      unmount: (container: HTMLElement) => {\r\n        const root = roots.get(container)\r\n\r\n        if (root) {\r\n          root.unmount()\r\n          roots.delete(container)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    mount: ReactDOM.render,\r\n    unmount: ReactDOM.unmountComponentAtNode\r\n  }\r\n}\r\n","import { useEffect, useRef, useState } from 'react'\r\nimport { flushSync } from 'react-dom'\r\n\r\nexport function Root({ children, rendered }: { children: JSX.Element | null, rendered: () => void }) {\r\n  useEffect(() => {\r\n    rendered()\r\n  })\r\n\r\n  return children\r\n}\r\n\r\nexport function syncFlush() {\r\n  const ready = useRef(false)\r\n\r\n  useEffect(() => {\r\n    ready.current = true\r\n  }, [])\r\n\r\n  return {\r\n    apply(f: () => void) {\r\n      if (ready.current) {\r\n        try {\r\n          flushSync(f)\r\n        } catch (error) {\r\n          const message = error ? (error as Error).message : null\r\n\r\n          if (message && (\r\n            message.includes('flushSync was called from inside a lifecycle method')\r\n            || message.includes('React error #187')\r\n          )) {\r\n            f()\r\n            return\r\n          }\r\n          throw error\r\n        }\r\n      } else {\r\n        f()\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function useRete<T extends { destroy(): void }>(create: (el: HTMLElement) => Promise<T>) {\r\n  const [container, setContainer] = useState<null | HTMLElement>(null)\r\n  const editorRef = useRef<T>()\r\n  const [editor, setEditor] = useState<T | null>(null)\r\n  const ref = useRef(null)\r\n\r\n  useEffect(() => {\r\n    if (container) {\r\n      if (editorRef.current) {\r\n        editorRef.current.destroy()\r\n        container.innerHTML = ''\r\n      }\r\n      create(container).then((value) => {\r\n        editorRef.current = value\r\n        setEditor(value)\r\n      })\r\n    }\r\n  }, [container, create])\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (editorRef.current) {\r\n        editorRef.current.destroy()\r\n      }\r\n    }\r\n  }, [])\r\n  useEffect(() => {\r\n    if (ref.current) {\r\n      setContainer(ref.current)\r\n    }\r\n  }, [ref.current])\r\n\r\n  return [ref, editor] as const\r\n}\r\n","import * as React from 'react'\r\nimport { createContext, useContext, useEffect, useState } from 'react'\r\n\r\nimport { Position } from '../../../types'\r\nimport { syncFlush } from '../../../utils'\r\n\r\nexport type ConnectionContextValue = { start: Position | null, end: Position | null, path: null | string }\r\n\r\nexport const ConnectionContext = createContext<ConnectionContextValue>({\r\n  start: null,\r\n  end: null,\r\n  path: null\r\n})\r\n\r\ntype PositionWatcher = (cb: (value: Position) => void) => (() => void)\r\n\r\ntype Props = {\r\n    children: JSX.Element,\r\n    start: Position | PositionWatcher,\r\n    end: Position | PositionWatcher,\r\n    path(start: Position, end: Position): Promise<null | string>\r\n}\r\n\r\nexport function ConnectionWrapper(props: Props) {\r\n  const { children } = props\r\n  const [computedStart, setStart] = useState<Position | null>(null)\r\n  const [computedEnd, setEnd] = useState<Position| null>(null)\r\n  const [path, setPath] = useState<string | null>(null)\r\n  const start = 'x' in props.start ? props.start : computedStart\r\n  const end = 'x' in props.end ? props.end : computedEnd\r\n  const flush = syncFlush()\r\n\r\n  useEffect(() => {\r\n    const unwatch1 = typeof props.start === 'function' && props.start(s => flush.apply(() => setStart(s)))\r\n    const unwatch2 = typeof props.end === 'function' && props.end(s => flush.apply(() => setEnd(s)))\r\n\r\n    return () => {\r\n      unwatch1 && unwatch1()\r\n      unwatch2 && unwatch2()\r\n    }\r\n  }, [])\r\n  useEffect(() => {\r\n    if (start && end) props.path(start, end).then(p => flush.apply(() => setPath(p)))\r\n  }, [start, end])\r\n\r\n  return (\r\n    <ConnectionContext.Provider value={{ start, end, path }}>\r\n      {children}\r\n    </ConnectionContext.Provider>\r\n  )\r\n}\r\n\r\nexport function useConnection() {\r\n  return useContext(ConnectionContext)\r\n}\r\n","import * as React from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { ClassicScheme } from '../types'\r\nimport { useConnection } from './ConnectionWrapper'\r\n\r\nconst Svg = styled.svg`\r\n    overflow: visible !important;\r\n    position: absolute;\r\n    pointer-events: none;\r\n    width: 9999px;\r\n    height: 9999px;\r\n`\r\n\r\nconst Path = styled.path<{ styles?: (props: any) => any }>`\r\n    fill: none;\r\n    stroke-width: 5px;\r\n    stroke: steelblue;\r\n    pointer-events: auto;\r\n    ${props => props.styles && props.styles(props)}\r\n`\r\n\r\nexport function Connection(props: { data: ClassicScheme['Connection'] & { isLoop?: boolean }, styles?: () => any }) {\r\n  const { path } = useConnection()\r\n\r\n  if (!path) return null\r\n\r\n  return (\r\n    <Svg data-testid=\"connection\">\r\n      <Path\r\n        styles={props.styles}\r\n        d={path} />\r\n    </Svg>\r\n  )\r\n}\r\n","export function copyEvent<T extends Event & Record<string, any>>(e: T) {\r\n  const newEvent = new (e.constructor as { new(type: string): T })(e.type)\r\n  let current = newEvent\r\n\r\n  while ((current = Object.getPrototypeOf(current))) {\r\n    const keys = Object.getOwnPropertyNames(current)\r\n\r\n    for (const k of keys) {\r\n      const item = newEvent[k]\r\n\r\n      if (typeof item === 'function') continue\r\n\r\n      Object.defineProperty(newEvent, k, { value: e[k] })\r\n    }\r\n  }\r\n\r\n  return newEvent\r\n}\r\n\r\nconst rootPrefix = '__reactContainer$'\r\n\r\ntype Keys = `${typeof rootPrefix}${string}` | '_reactRootContainer'\r\ntype ReactNode = { [key in Keys]?: unknown } & HTMLElement\r\n\r\nexport function findReactRoot(element: HTMLElement) {\r\n  let current: ReactNode | null = element as ReactNode\r\n\r\n  while (current) {\r\n    if (current._reactRootContainer || Object.keys(current).some(key => key.startsWith(rootPrefix))) return current\r\n    current = current.parentElement as ReactNode\r\n  }\r\n}\r\n","import * as React from 'react'\r\n\r\nimport { Position } from '../types'\r\nimport { copyEvent, findReactRoot } from './utils'\r\n\r\ntype Translate = (dx: number, dy: number) => void\r\ntype StartEvent = { pageX: number, pageY: number }\r\n\r\nexport function useDrag(translate: Translate, getPointer: (e: StartEvent) => Position) {\r\n  return {\r\n    start(e: StartEvent) {\r\n      let previous = { ...getPointer(e) }\r\n\r\n      function move(moveEvent: MouseEvent) {\r\n        const current = { ...getPointer(moveEvent) }\r\n        const dx = current.x - previous.x\r\n        const dy = current.y - previous.y\r\n\r\n        previous = current\r\n\r\n        translate(dx, dy)\r\n      }\r\n      function up() {\r\n        window.removeEventListener('pointermove', move)\r\n        window.removeEventListener('pointerup', up)\r\n        window.removeEventListener('pointercancel', up)\r\n      }\r\n\r\n      window.addEventListener('pointermove', move)\r\n      window.addEventListener('pointerup', up)\r\n      window.addEventListener('pointercancel', up)\r\n    }\r\n  }\r\n}\r\n\r\nexport function useNoDrag(ref: React.MutableRefObject<HTMLElement | null>, disabled?: boolean) {\r\n  React.useEffect(() => {\r\n    const handleClick = (e: PointerEvent) => {\r\n      if (disabled) return\r\n\r\n      const root = findReactRoot(e.target as HTMLElement)\r\n      const target = React.version.startsWith('16') ? document : root\r\n\r\n      if (target) {\r\n        e.stopPropagation()\r\n        target.dispatchEvent(copyEvent(e))\r\n      }\r\n    }\r\n    const el = ref.current\r\n\r\n    el?.addEventListener('pointerdown', handleClick)\r\n\r\n    return () => {\r\n      el?.removeEventListener('pointerdown', handleClick)\r\n    }\r\n  }, [ref, disabled])\r\n}\r\n\r\nexport function NoDrag(props: { children: React.ReactNode, disabled?: boolean }) {\r\n  const ref = React.useRef<HTMLDivElement | null>(null)\r\n\r\n  useNoDrag(ref, props.disabled)\r\n\r\n  return <span ref={ref}>{props.children}</span>\r\n}\r\n","import * as React from 'react'\r\nimport { ClassicPreset } from 'rete'\r\nimport styled from 'styled-components'\r\n\r\nimport { Drag } from '../../../shared'\r\n\r\nconst Input = styled.input<{ styles?: (props: any) => any }>`\r\n  width: 100%;\r\n  border-radius: 30px;\r\n  background-color: white;\r\n  padding: 2px 6px;\r\n  border: 1px solid #999;\r\n  font-size: 110%;\r\n  box-sizing: border-box;\r\n  ${props => props.styles && props.styles(props)}\r\n`\r\n\r\nexport function Control<N extends 'text' | 'number'>(props: { data: ClassicPreset.InputControl<N>, styles?: () => any }) {\r\n  const [value, setValue] = React.useState(props.data.value)\r\n  const ref = React.useRef(null)\r\n\r\n  Drag.useNoDrag(ref)\r\n\r\n  React.useEffect(() => {\r\n    setValue(props.data.value)\r\n  }, [props.data.value])\r\n\r\n  return (\r\n    <Input\r\n      value={value}\r\n      type={props.data.type}\r\n      ref={ref}\r\n      readOnly={props.data.readonly}\r\n      onChange={e => {\r\n        const val = (props.data.type === 'number'\r\n          ? +e.target.value\r\n          : e.target.value) as typeof props.data['value']\r\n\r\n        setValue(val)\r\n        props.data.setValue(val)\r\n      }}\r\n      styles={props.styles}\r\n    />\r\n  )\r\n}\r\n","export const $nodecolor = 'rgba(110,136,255,0.8)'\r\nexport const $nodecolorselected = '#ffd92c'\r\nexport const $socketsize = 24\r\nexport const $socketmargin = 6\r\nexport const $socketcolor = '#96b38a'\r\nexport const $nodewidth = 180\r\n","import * as React from 'react'\r\n\r\ntype RefUpdate = (ref: HTMLElement) => void\r\ntype BaseProps = { init: RefUpdate, unmount: RefUpdate } & Record<string, unknown>\r\n\r\n/**\r\n * Component for rendering various elements embedded in the React.js component tree.\r\n */\r\nexport function RefComponent<Props extends BaseProps>({ init, unmount, ...props }: Props) {\r\n  const ref = React.useRef<HTMLSpanElement>(null)\r\n\r\n  React.useEffect(() => {\r\n    const element = ref.current\r\n\r\n    return () => {\r\n      if (element) unmount(element)\r\n    }\r\n  }, [])\r\n  React.useEffect(() => {\r\n    if (ref.current) init(ref.current)\r\n  })\r\n\r\n  return <span {...props} ref={ref} />\r\n}\r\n","import * as React from 'react'\r\nimport { ClassicPreset } from 'rete'\r\n\r\nimport { RefComponent } from '../../../../ref-component'\r\nimport { ClassicScheme, GetControls, ReactArea2D } from '../../types'\r\n\r\ntype Props<Scheme extends ClassicScheme> = {\r\n  name: string\r\n  emit: (props: ReactArea2D<Scheme>) => void\r\n  payload: ClassicPreset.Control\r\n}\r\n\r\nexport function RefControl<Scheme extends ClassicScheme>({ name, emit, payload, ...props }: Props<Scheme>) {\r\n  return <RefComponent\r\n    {...props}\r\n    className={name}\r\n    init={ref => emit({ type: 'render', data: {\r\n      type: 'control',\r\n      element: ref,\r\n      payload: payload as GetControls<Scheme['Node']>\r\n    } })}\r\n    unmount={ref => emit({ type: 'unmount', data: { element: ref } })}\r\n  />\r\n}\r\n","import * as React from 'react'\r\nimport { ClassicPreset, NodeId } from 'rete'\r\n\r\nimport { RefComponent } from '../../../../ref-component'\r\nimport { ClassicScheme, GetSockets, ReactArea2D, Side } from '../../types'\r\n\r\ntype Props<Scheme extends ClassicScheme> = {\r\n  name: string\r\n  emit: (props: ReactArea2D<Scheme>) => void\r\n  side: Side\r\n  nodeId: NodeId\r\n  socketKey: string\r\n  payload: ClassicPreset.Socket\r\n}\r\n\r\nexport function RefSocket<Scheme extends ClassicScheme>({ name, emit, nodeId, side, socketKey, payload, ...props }: Props<Scheme>) {\r\n  return <RefComponent\r\n    {...props}\r\n    className={name}\r\n    init={ref => emit({ type: 'render', data: {\r\n      type: 'socket',\r\n      side,\r\n      key: socketKey,\r\n      nodeId,\r\n      element: ref,\r\n      payload: payload as GetSockets<Scheme['Node']>\r\n    } })}\r\n    unmount={ref => emit({ type: 'unmount', data: { element: ref } })}\r\n  />\r\n}\r\n","import * as React from 'react'\r\nimport styled, { css } from 'styled-components'\r\n\r\nimport { ClassicScheme, RenderEmit } from '../types'\r\nimport { $nodecolor, $nodecolorselected, $nodewidth, $socketmargin, $socketsize } from '../vars'\r\nimport { RefControl } from './refs/RefControl'\r\nimport { RefSocket } from './refs/RefSocket'\r\n\r\ntype NodeExtraData = { width?: number, height?: number }\r\n\r\nexport const NodeStyles = styled.div<NodeExtraData & { selected: boolean, styles?: (props: any) => any }>`\r\n    background: ${$nodecolor};\r\n    border: 2px solid #4e58bf;\r\n    border-radius: 10px;\r\n    cursor: pointer;\r\n    box-sizing: border-box;\r\n    width: ${props => Number.isFinite(props.width) ? `${props.width}px` : `${$nodewidth}px`};\r\n    height: ${props => Number.isFinite(props.height) ? `${props.height}px` : 'auto'};\r\n    padding-bottom: 6px;\r\n    position: relative;\r\n    user-select: none;\r\n    line-height: initial;\r\n    font-family: Arial;\r\n\r\n    &:hover {\r\n        background: lighten(${$nodecolor},4%);\r\n    }\r\n    ${props => props.selected && css`\r\n        background: ${$nodecolorselected};\r\n        border-color: #e3c000;\r\n    `}\r\n    .title {\r\n        color: white;\r\n        font-family: sans-serif;\r\n        font-size: 18px;\r\n        padding: 8px;\r\n    }\r\n    .output {\r\n        text-align: right;\r\n    }\r\n    .input {\r\n        text-align: left;\r\n    }\r\n    .output-socket {\r\n        text-align: right;\r\n        margin-right: -${$socketsize / 2 + $socketmargin}px;\r\n        display: inline-block;\r\n    }\r\n    .input-socket {\r\n        text-align: left;\r\n        margin-left: -${$socketsize / 2 + $socketmargin}px;\r\n        display: inline-block;\r\n    }\r\n    .input-title,.output-title {\r\n        vertical-align: middle;\r\n        color: white;\r\n        display: inline-block;\r\n        font-family: sans-serif;\r\n        font-size: 14px;\r\n        margin: ${$socketmargin}px;\r\n        line-height: ${$socketsize}px;\r\n    }\r\n    .input-control {\r\n        z-index: 1;\r\n        width: calc(100% - ${$socketsize + 2 * $socketmargin}px);\r\n        vertical-align: middle;\r\n        display: inline-block;\r\n    }\r\n    .control {\r\n        display: block;\r\n        padding: ${$socketmargin}px ${$socketsize / 2 + $socketmargin}px;\r\n    }\r\n    ${props => props.styles && props.styles(props)}\r\n`\r\n\r\nfunction sortByIndex<T extends [string, undefined | { index?: number }][]>(entries: T) {\r\n  entries.sort((a, b) => {\r\n    const ai = a[1]?.index || 0\r\n    const bi = b[1]?.index || 0\r\n\r\n    return ai - bi\r\n  })\r\n}\r\n\r\ntype Props<S extends ClassicScheme> = {\r\n    data: S['Node'] & NodeExtraData\r\n    styles?: () => any\r\n    emit: RenderEmit<S>\r\n}\r\nexport type NodeComponent<Scheme extends ClassicScheme> = (props: Props<Scheme>) => JSX.Element\r\n\r\n// eslint-disable-next-line max-statements\r\nexport function Node<Scheme extends ClassicScheme>(props: Props<Scheme>) {\r\n  const inputs = Object.entries(props.data.inputs)\r\n  const outputs = Object.entries(props.data.outputs)\r\n  const controls = Object.entries(props.data.controls)\r\n  const selected = props.data.selected || false\r\n  const { id, label, width, height } = props.data\r\n\r\n  sortByIndex(inputs)\r\n  sortByIndex(outputs)\r\n  sortByIndex(controls)\r\n\r\n  return (\r\n    <NodeStyles\r\n      selected={selected}\r\n      width={width}\r\n      height={height}\r\n      styles={props.styles}\r\n      data-testid=\"node\"\r\n    >\r\n      <div className=\"title\" data-testid=\"title\">{label}</div>\r\n      {/* Outputs */}\r\n      {outputs.map(([key, output]) => (\r\n        output && <div className=\"output\" key={key} data-testid={`output-${key}`}>\r\n          <div className=\"output-title\" data-testid=\"output-title\">{output?.label}</div>\r\n          <RefSocket\r\n            name=\"output-socket\"\r\n            side=\"output\"\r\n            socketKey={key}\r\n            nodeId={id}\r\n            emit={props.emit}\r\n            payload={output.socket}\r\n            data-testid=\"output-socket\"\r\n          />\r\n        </div>\r\n      ))}\r\n      {/* Controls */}\r\n      {controls.map(([key, control]) => {\r\n        return control ? <RefControl\r\n          key={key}\r\n          name=\"control\"\r\n          emit={props.emit}\r\n          payload={control}\r\n          data-testid={`control-${key}`}\r\n        /> : null\r\n      })}\r\n      {/* Inputs */}\r\n      {inputs.map(([key, input]) => (\r\n        input && <div className=\"input\" key={key} data-testid={`input-${key}`}>\r\n          <RefSocket\r\n            name=\"input-socket\"\r\n            side=\"input\"\r\n            socketKey={key}\r\n            nodeId={id}\r\n            emit={props.emit}\r\n            payload={input.socket}\r\n            data-testid=\"input-socket\"\r\n          />\r\n          {input && (!input.control || !input.showControl) && (\r\n            <div className=\"input-title\" data-testid=\"input-title\">{input?.label}</div>\r\n          )}\r\n          {input?.control && input?.showControl && (\r\n            <RefControl\r\n              key={key}\r\n              name=\"input-control\"\r\n              emit={props.emit}\r\n              payload={input.control}\r\n              data-testid=\"input-control\"\r\n            />\r\n          )\r\n          }\r\n        </div>\r\n      ))}\r\n    </NodeStyles>\r\n  )\r\n}\r\n","import * as React from 'react'\r\nimport { ClassicPreset } from 'rete'\r\nimport styled from 'styled-components'\r\n\r\nimport { $socketcolor, $socketmargin, $socketsize } from '../vars'\r\n\r\nconst Styles = styled.div`\r\n    display: inline-block;\r\n    cursor: pointer;\r\n    border: 1px solid white;\r\n    border-radius: ${$socketsize/2.0}px;\r\n    width: ${$socketsize}px;\r\n    height: ${$socketsize}px;\r\n    vertical-align: middle;\r\n    background: ${$socketcolor};\r\n    z-index: 2;\r\n    box-sizing: border-box;\r\n    &:hover {\r\n      border-width: 4px;\r\n    }\r\n    &.multiple {\r\n      border-color: yellow;\r\n    }\r\n`\r\n\r\nconst Hoverable = styled.div`\r\n    border-radius: ${($socketsize + $socketmargin * 2)/2.0}px;\r\n    padding: ${$socketmargin}px;\r\n    &:hover ${Styles} {\r\n      border-width: 4px;\r\n    }\r\n`\r\n\r\nexport function Socket<T extends ClassicPreset.Socket>(props: { data: T }) {\r\n  return (\r\n    <Hoverable>\r\n      <Styles title={props.data.name} />\r\n    </Hoverable>\r\n  )\r\n}\r\n","import * as React from 'react'\r\nimport { ClassicPreset, Scope } from 'rete'\r\nimport {\r\n  classicConnectionPath, getDOMSocketPosition,\r\n  loopConnectionPath, SocketPositionWatcher\r\n} from 'rete-render-utils'\r\n\r\nimport { Position } from '../../types'\r\nimport { RenderPreset } from '../types'\r\nimport { Connection } from './components/Connection'\r\nimport { ConnectionWrapper } from './components/ConnectionWrapper'\r\nimport { Control } from './components/Control'\r\nimport { Node } from './components/Node'\r\nimport { Socket } from './components/Socket'\r\nimport {\r\n  ClassicScheme, ExtractPayload, ReactArea2D, RenderEmit\r\n} from './types'\r\nimport { AcceptComponent } from './utility-types'\r\n\r\nexport { Connection } from './components/Connection'\r\nexport { useConnection } from './components/ConnectionWrapper'\r\nexport { Control } from './components/Control'\r\nexport { Control as InputControl } from './components/Control'\r\nexport { Node, NodeStyles } from './components/Node'\r\nexport { RefControl } from './components/refs/RefControl'\r\nexport { RefSocket } from './components/refs/RefSocket'\r\nexport { Socket } from './components/Socket'\r\nexport type { ClassicScheme, ReactArea2D, RenderEmit } from './types'\r\nexport * as vars from './vars'\r\n\r\ntype CustomizationProps<Schemes extends ClassicScheme> = {\r\n  node?: (data: ExtractPayload<Schemes, 'node'>) => AcceptComponent<typeof data['payload'], { emit: RenderEmit<Schemes> }> | null\r\n  connection?: (data: ExtractPayload<Schemes, 'connection'>) => AcceptComponent<typeof data['payload']> | null\r\n  socket?: (data: ExtractPayload<Schemes, 'socket'>) => AcceptComponent<typeof data['payload']> | null\r\n  control?: (data: ExtractPayload<Schemes, 'control'>) => AcceptComponent<typeof data['payload']> | null\r\n}\r\n\r\ntype ClassicProps<Schemes extends ClassicScheme, K> = {\r\n  socketPositionWatcher?: SocketPositionWatcher<Scope<never, [K]>>\r\n  customize?: CustomizationProps<Schemes>\r\n}\r\n\r\n/**\r\n * Classic preset for rendering nodes, connections, controls and sockets.\r\n */\r\nexport function setup<Schemes extends ClassicScheme, K extends ReactArea2D<Schemes>>(\r\n  props?: ClassicProps<Schemes, K>\r\n): RenderPreset<Schemes, K> {\r\n  const positionWatcher = typeof props?.socketPositionWatcher === 'undefined'\r\n    ? getDOMSocketPosition<Schemes, K>()\r\n    : props?.socketPositionWatcher\r\n  const { node, connection, socket, control } = props?.customize || {}\r\n\r\n  return {\r\n    attach(plugin) {\r\n      positionWatcher.attach(plugin as unknown as Scope<never, [K]>)\r\n    },\r\n    // eslint-disable-next-line max-statements, complexity\r\n    render(context, plugin) {\r\n      if (context.data.type === 'node') {\r\n        const parent = plugin.parentScope()\r\n        const Component = (node ? node(context.data) : Node) as typeof Node\r\n\r\n        return (Component &&\r\n          <Component\r\n            data={context.data.payload}\r\n            emit={data => parent.emit(data as any)}\r\n          />\r\n        )\r\n      } else if (context.data.type === 'connection') {\r\n        const Component = (connection ? connection(context.data) : Connection) as typeof Connection\r\n        const payload = context.data.payload\r\n        const { sourceOutput, targetInput, source, target } = payload\r\n\r\n        return (Component &&\r\n          <ConnectionWrapper\r\n            start={context.data.start || (change => positionWatcher.listen(source, 'output', sourceOutput, change))}\r\n            end={context.data.end || (change => positionWatcher.listen(target, 'input', targetInput, change))}\r\n            path={async (start, end) => {\r\n              type FixImplicitAny = typeof plugin.__scope.produces | undefined\r\n              const response: FixImplicitAny = await plugin.emit({\r\n                type: 'connectionpath', data: {\r\n                  payload,\r\n                  points: [start, end]\r\n                }\r\n              })\r\n\r\n              if (!response) return ''\r\n\r\n              const { path, points } = response.data\r\n              const curvature = 0.3\r\n\r\n              if (!path && points.length !== 2) throw new Error('cannot render connection with a custom number of points')\r\n              if (!path) return payload.isLoop\r\n                ? loopConnectionPath(points as [Position, Position], curvature, 120)\r\n                : classicConnectionPath(points as [Position, Position], curvature)\r\n\r\n              return path\r\n            }}\r\n          >\r\n            <Component data={context.data.payload} />\r\n          </ConnectionWrapper>\r\n        )\r\n      } else if (context.data.type === 'socket') {\r\n        const Component = (socket ? socket(context.data) : Socket) as typeof Socket\r\n\r\n        return (Component && context.data.payload && <Component data={context.data.payload} />\r\n        )\r\n      } else if (context.data.type === 'control') {\r\n        const Component = control && context.data.payload\r\n          ? control(context.data)\r\n          : (\r\n            context.data.payload instanceof ClassicPreset.InputControl\r\n              ? Control\r\n              : null\r\n          )\r\n\r\n        return Component && <Component data={context.data.payload as any} />\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { useEffect, useRef } from 'react'\r\n\r\nexport function useDebounce(cb: () => void, timeout: number): [null | (() => void), () => void] {\r\n  const ref = useRef<ReturnType<typeof setTimeout>>()\r\n\r\n  function cancel() {\r\n    ref.current && clearTimeout(ref.current)\r\n  }\r\n  const func = () => {\r\n    cancel()\r\n\r\n    ref.current = setTimeout(() => {\r\n      cb()\r\n    }, timeout)\r\n  }\r\n\r\n  useEffect(() => cancel, [])\r\n\r\n  return [\r\n    func,\r\n    cancel\r\n  ]\r\n}\r\n","\r\nexport const $contextColor = 'rgba(110,136,255,0.8)'\r\nexport const $contextColorLight = 'rgba(130, 153, 255, 0.8)'\r\nexport const $contextColorDark = 'rgba(69, 103, 255, 0.8)'\r\nexport const $contextMenuRound = '5px'\r\nexport const $width = 120\r\n","import styled from 'styled-components'\r\n\r\nimport { $contextColor, $contextColorDark, $contextColorLight, $contextMenuRound } from './vars'\r\n\r\nexport const CommonStyle = styled.div`\r\n  color: #fff;\r\n  padding: 4px;\r\n  border-bottom: 1px solid ${$contextColorDark};\r\n  background-color: ${$contextColor};\r\n  cursor: pointer;\r\n  width: 100%;\r\n  position: relative;\r\n  &:first-child {\r\n    border-top-left-radius: ${$contextMenuRound};\r\n    border-top-right-radius: ${$contextMenuRound};\r\n  }\r\n  &:last-child {\r\n    border-bottom-left-radius: ${$contextMenuRound};\r\n    border-bottom-right-radius: ${$contextMenuRound};\r\n  }\r\n  &:hover {\r\n    background-color: ${$contextColorLight};\r\n  }\r\n`\r\n","import * as React from 'react'\r\nimport styled, { css } from 'styled-components'\r\n\r\nimport { useDebounce } from '../hooks'\r\nimport { CommonStyle } from '../styles'\r\nimport { Customize, Item } from '../types'\r\nimport { $width } from '../vars'\r\n\r\nexport const ItemStyle = styled(CommonStyle) <{ hasSubitems?: boolean }>`\r\n    ${props => props.hasSubitems && css`&:after {\r\n    content: 'â–º';\r\n    position: absolute;\r\n    opacity: 0.6;\r\n    right: 5px;\r\n    top: 5px;\r\n    }`}\r\n`\r\n\r\nexport const SubitemStyles = styled.div`\r\n    position: absolute;\r\n    top: 0;\r\n    left: 100%;\r\n    width: ${$width}px;\r\n`\r\n\r\ntype Props = {\r\n  data: Item\r\n  delay: number\r\n  hide(): void\r\n  children: React.ReactNode\r\n  components?: Pick<Customize, 'item' | 'subitems'>\r\n}\r\n\r\nexport function ItemElement(props: Props) {\r\n  const [visibleSubitems, setVisibleSubitems] = React.useState(false)\r\n  const setInvisibile = React.useCallback(() => setVisibleSubitems(false), [setVisibleSubitems])\r\n  const [hide, cancelHide] = useDebounce(setInvisibile, props.delay)\r\n  const Component = props.components?.item?.(props.data) || ItemStyle\r\n  const Subitems = props.components?.subitems?.(props.data) || SubitemStyles\r\n\r\n  return <Component\r\n    onClick={e => { e.stopPropagation(); props.data.handler(); props.hide() }}\r\n    hasSubitems={Boolean(props.data.subitems)}\r\n    onPointerDown={e => e.stopPropagation()}\r\n    onPointerOver={() => { cancelHide(); setVisibleSubitems(true) }}\r\n    onPointerLeave={() => hide && hide()}\r\n    data-testid=\"context-menu-item\"\r\n  >\r\n    {props.children}\r\n    {props.data.subitems && visibleSubitems && (\r\n      <Subitems>\r\n        {props.data.subitems.map(item => (\r\n          <ItemElement\r\n            key={item.key}\r\n            data={item}\r\n            delay={props.delay}\r\n            hide={props.hide}\r\n            components={props.components}\r\n          >{item.label}</ItemElement>\r\n        ))}\r\n      </Subitems>\r\n    )}\r\n  </Component>\r\n}\r\n","import * as React from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { ComponentType } from '../types'\r\n\r\nexport const SearchInput = styled.input`\r\n  color: white;\r\n  padding: 1px 8px;\r\n  border: 1px solid white;\r\n  border-radius: 10px;\r\n  font-size: 16px;\r\n  font-family: serif;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n  background: transparent;\r\n`\r\n\r\nexport function Search(props: { value: string, onChange(value: string): void, component?: ComponentType }) {\r\n  const Component = props.component || SearchInput\r\n\r\n  return (\r\n    <Component\r\n      value={props.value}\r\n      onInput={e => props.onChange((e.target as HTMLInputElement).value)}\r\n      onPointerDown={e => e.stopPropagation()}\r\n      data-testid=\"context-menu-search-input\"\r\n    />\r\n  )\r\n}\r\n","import * as React from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { useDebounce } from '../hooks'\r\nimport { CommonStyle } from '../styles'\r\nimport { Customize, Item } from '../types'\r\nimport { $width } from '../vars'\r\nimport { ItemElement } from './Item'\r\nimport { Search } from './Search'\r\n\r\nexport const Styles = styled.div`\r\n  padding: 10px;\r\n  width: ${$width}px;\r\n  margin-top: -20px;\r\n  margin-left: -${$width / 2}px;\r\n`\r\n\r\ntype Props = {\r\n  items: Item[]\r\n  delay: number\r\n  searchBar?: boolean\r\n  onHide(): void\r\n  components?: Customize\r\n}\r\n\r\nexport function Menu(props: Props) {\r\n  const [hide, cancelHide] = useDebounce(props.onHide, props.delay)\r\n  const [filter, setFilter] = React.useState('')\r\n  const filterRegexp = new RegExp(filter, 'i')\r\n  const filteredList = props.items.filter(item => (\r\n    item.label.match(filterRegexp)\r\n  ))\r\n  const Component = props.components?.main?.() || Styles\r\n  const Common = props.components?.common?.() || CommonStyle\r\n\r\n  return <Component\r\n    onMouseOver={() => cancelHide()}\r\n    onMouseLeave={() => hide && hide()}\r\n    onWheel={e => e.stopPropagation()}\r\n    data-testid=\"context-menu\"\r\n  >\r\n    {props.searchBar && (\r\n      <Common>\r\n        <Search value={filter} onChange={setFilter} component={props.components?.search?.()} />\r\n      </Common>\r\n    )}\r\n    {filteredList.map(item => {\r\n      return <ItemElement\r\n        key={item.key}\r\n        data={item}\r\n        delay={props.delay}\r\n        hide={props.onHide}\r\n        components={props.components}\r\n      >\r\n        {item.label}\r\n      </ItemElement>\r\n    })}\r\n  </Component>\r\n}\r\n","\r\nimport * as React from 'react'\r\nimport { BaseSchemes } from 'rete'\r\n\r\nimport { RenderPreset } from '../types'\r\nimport { Menu } from './components/Menu'\r\nimport { ContextMenuRender, Customize } from './types'\r\n\r\nexport { ItemStyle as Item, SubitemStyles as Subitems } from './components/Item'\r\nexport { Styles as Menu } from './components/Menu'\r\nexport { SearchInput as Search } from './components/Search'\r\nexport { CommonStyle as Common } from './styles'\r\n\r\ntype Props = {\r\n  delay?: number\r\n  customize?: Customize\r\n}\r\n\r\n/**\r\n * Preset for rendering context menu.\r\n */\r\nexport function setup<Schemes extends BaseSchemes, K extends ContextMenuRender>(props?: Props): RenderPreset<Schemes, K> {\r\n  const delay = typeof props?.delay === 'undefined' ? 1000 : props.delay\r\n\r\n  return {\r\n    render(context) {\r\n      if (context.data.type === 'contextmenu') {\r\n        return <Menu\r\n          items={context.data.items}\r\n          delay={delay}\r\n          searchBar={context.data.searchBar}\r\n          onHide={context.data.onHide}\r\n          components={props?.customize}\r\n        />\r\n      }\r\n    }\r\n  }\r\n}\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { useState } from 'react';\nfunction useCopyToClipboard() {\n    const [copiedText, setCopiedText] = useState(null);\n    const copy = (text) => __awaiter(this, void 0, void 0, function* () {\n        if (!(navigator === null || navigator === void 0 ? void 0 : navigator.clipboard)) {\n            console.warn('Clipboard not supported');\n            return false;\n        }\n        try {\n            yield navigator.clipboard.writeText(text);\n            setCopiedText(text);\n            return true;\n        }\n        catch (error) {\n            console.warn('Copy failed', error);\n            setCopiedText(null);\n            return false;\n        }\n    });\n    return [copiedText, copy];\n}\nexport default useCopyToClipboard;\n","import { useCallback, useState } from 'react';\nimport { useEventListener, useIsomorphicLayoutEffect } from '..';\nfunction useElementSize() {\n    const [ref, setRef] = useState(null);\n    const [size, setSize] = useState({\n        width: 0,\n        height: 0,\n    });\n    const handleSize = useCallback(() => {\n        setSize({\n            width: (ref === null || ref === void 0 ? void 0 : ref.offsetWidth) || 0,\n            height: (ref === null || ref === void 0 ? void 0 : ref.offsetHeight) || 0,\n        });\n    }, [ref === null || ref === void 0 ? void 0 : ref.offsetHeight, ref === null || ref === void 0 ? void 0 : ref.offsetWidth]);\n    useEventListener('resize', handleSize);\n    useIsomorphicLayoutEffect(() => {\n        handleSize();\n    }, [ref === null || ref === void 0 ? void 0 : ref.offsetHeight, ref === null || ref === void 0 ? void 0 : ref.offsetWidth]);\n    return [setRef, size];\n}\nexport default useElementSize;\n","import { useEffect, useRef } from 'react';\nimport { useIsomorphicLayoutEffect } from '..';\nfunction useEventListener(eventName, handler, element, options) {\n    const savedHandler = useRef(handler);\n    useIsomorphicLayoutEffect(() => {\n        savedHandler.current = handler;\n    }, [handler]);\n    useEffect(() => {\n        var _a;\n        const targetElement = (_a = element === null || element === void 0 ? void 0 : element.current) !== null && _a !== void 0 ? _a : window;\n        if (!(targetElement && targetElement.addEventListener))\n            return;\n        const listener = event => savedHandler.current(event);\n        targetElement.addEventListener(eventName, listener, options);\n        return () => {\n            targetElement.removeEventListener(eventName, listener, options);\n        };\n    }, [eventName, element, options]);\n}\nexport default useEventListener;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { useEffect, useReducer, useRef } from 'react';\nfunction useFetch(url, options) {\n    const cache = useRef({});\n    const cancelRequest = useRef(false);\n    const initialState = {\n        error: undefined,\n        data: undefined,\n    };\n    const fetchReducer = (state, action) => {\n        switch (action.type) {\n            case 'loading':\n                return Object.assign({}, initialState);\n            case 'fetched':\n                return Object.assign(Object.assign({}, initialState), { data: action.payload });\n            case 'error':\n                return Object.assign(Object.assign({}, initialState), { error: action.payload });\n            default:\n                return state;\n        }\n    };\n    const [state, dispatch] = useReducer(fetchReducer, initialState);\n    useEffect(() => {\n        if (!url)\n            return;\n        cancelRequest.current = false;\n        const fetchData = () => __awaiter(this, void 0, void 0, function* () {\n            dispatch({ type: 'loading' });\n            if (cache.current[url]) {\n                dispatch({ type: 'fetched', payload: cache.current[url] });\n                return;\n            }\n            try {\n                const response = yield fetch(url, options);\n                if (!response.ok) {\n                    throw new Error(response.statusText);\n                }\n                const data = (yield response.json());\n                cache.current[url] = data;\n                if (cancelRequest.current)\n                    return;\n                dispatch({ type: 'fetched', payload: data });\n            }\n            catch (error) {\n                if (cancelRequest.current)\n                    return;\n                dispatch({ type: 'error', payload: error });\n            }\n        });\n        void fetchData();\n        return () => {\n            cancelRequest.current = true;\n        };\n    }, [url]);\n    return state;\n}\nexport default useFetch;\n","import { useEffect, useLayoutEffect } from 'react';\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\nexport default useIsomorphicLayoutEffect;\n","export function px(value: number) {\r\n  return `${value}px`\r\n}\r\n","import * as React from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { px } from '../utils'\r\n\r\nconst Styles = styled.div`\r\n    position: absolute;\r\n    background: #7C43C5;\r\n    border: 1px solid #7C43C5;\r\n`\r\n\r\nexport function MiniNode(props: { left: number, top: number, width: number, height: number }) {\r\n  return <Styles style={{\r\n    left: px(props.left),\r\n    top: px(props.top),\r\n    width: px(props.width),\r\n    height: px(props.height)\r\n  }} data-testid=\"minimap-node\" />\r\n}\r\n","import * as React from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { useDrag } from '../../../shared/drag'\r\nimport { Rect, Transform, Translate } from '../types'\r\nimport { px } from '../utils'\r\n\r\nconst MiniViewportStyles = styled.div`\r\n  position: absolute;\r\n  background: #090E2CCC;\r\n  border: 1px solid #121D64;\r\n`\r\n\r\nexport function MiniViewport(props: Rect & { containerWidth: number, start(): Transform, translate: Translate }) {\r\n  const scale = (v: number) => v * props.containerWidth\r\n  const invert = (v: number) => v / props.containerWidth\r\n  const drag = useDrag((dx, dy) => props.translate(invert(-dx), invert(-dy)), e => ({ x: e.pageX, y: e.pageY }))\r\n\r\n  return <MiniViewportStyles\r\n    onPointerDown={drag.start}\r\n    style={{\r\n      left: px(scale(props.left)),\r\n      top: px(scale(props.top)),\r\n      width: px(scale(props.width)),\r\n      height: px(scale(props.height))\r\n    }}\r\n    data-testid=\"minimap-viewport\"\r\n  />\r\n}\r\n","import * as React from 'react'\r\nimport { useCallback, useRef } from 'react'\r\nimport styled from 'styled-components'\r\nimport { useElementSize } from 'usehooks-ts'\r\n\r\nimport { Rect, Transform, Translate } from '../types'\r\nimport { px } from '../utils'\r\nimport { MiniNode } from './MiniNode'\r\nimport { MiniViewport } from './MiniViewport'\r\n\r\nconst Styles = styled.div<{ size: number }>`\r\n    position: absolute;\r\n    right: 24px;\r\n    bottom: 24px;\r\n    background: #010418;\r\n    padding: 20px;\r\n    overflow: hidden;\r\n    border: 2px solid #3C2857;\r\n    border-radius: 8px;\r\n    box-sizing: border-box;\r\n`\r\n\r\ntype Props = {\r\n  size: number\r\n  ratio: number\r\n  nodes: Rect[]\r\n  viewport: Rect\r\n  start(): Transform\r\n  translate: Translate\r\n  point(x: number, y: number): void\r\n}\r\n\r\nexport function Minimap(props: Props) {\r\n  const container = useRef<HTMLElement | null>()\r\n  const [containerRef, { width: containerWidth }] = useElementSize()\r\n  const scale = (v: number) => v * containerWidth\r\n  const ref = useCallback((node: HTMLDivElement | null) => {\r\n    container.current = node\r\n    containerRef(node)\r\n  }, [containerRef])\r\n\r\n  return <Styles\r\n    size={props.size}\r\n    style={{\r\n      width: px(props.size * props.ratio),\r\n      height: px(props.size)\r\n    }}\r\n    onPointerDown={e => {\r\n      e.stopPropagation()\r\n      e.preventDefault()\r\n    }}\r\n    onDoubleClick={e => {\r\n      e.stopPropagation()\r\n      e.preventDefault()\r\n      if (!container.current) return\r\n      const box = container.current.getBoundingClientRect()\r\n      const x = (e.clientX - box.left) / (props.size * props.ratio)\r\n      const y = (e.clientY - box.top) / (props.size * props.ratio)\r\n\r\n      props.point(x, y)\r\n    }}\r\n    ref={ref}\r\n    data-testid=\"minimap\"\r\n  >\r\n    {containerWidth && props.nodes.map((node, i) => (\r\n      <MiniNode\r\n        key={i}\r\n        left={scale(node.left)}\r\n        top={scale(node.top)}\r\n        width={scale(node.width)}\r\n        height={scale(node.height)}\r\n      />\r\n    ))}\r\n    <MiniViewport\r\n      {...props.viewport}\r\n      start={props.start}\r\n      containerWidth={containerWidth}\r\n      translate={props.translate}\r\n    />\r\n  </Styles>\r\n}\r\n","\r\nimport * as React from 'react'\r\nimport { BaseSchemes } from 'rete'\r\n\r\nimport { RenderPreset } from '../types'\r\nimport { Minimap } from './components/Minimap'\r\nimport { MinimapRender } from './types'\r\n\r\n/**\r\n * Preset for rendering minimap.\r\n */\r\nexport function setup<Schemes extends BaseSchemes, K extends MinimapRender>(props?: { size?: number }): RenderPreset<Schemes, K> {\r\n  return {\r\n    render(context) {\r\n      if (context.data.type === 'minimap') {\r\n        return <Minimap\r\n          nodes={context.data.nodes}\r\n          size={props?.size || 200}\r\n          ratio={context.data.ratio}\r\n          viewport={context.data.viewport}\r\n          start={context.data.start}\r\n          translate={context.data.translate}\r\n          point={context.data.point}\r\n        />\r\n      }\r\n    }\r\n  }\r\n}\r\n","import * as React from 'react'\r\nimport styled, { } from 'styled-components'\r\n\r\nimport { useDrag } from '../../shared/drag'\r\nimport { Position } from '../../types'\r\nimport { Pin as PinType } from './types'\r\n\r\nconst pinSize = 20\r\n\r\nconst Styles = styled.div<{ selected?: boolean }>`\r\n  width: ${pinSize}px;\r\n  height: ${pinSize}px;\r\n  box-sizing: border-box;\r\n  background: ${props => props.selected ? '#ffd92c' : 'steelblue'};\r\n  border: 2px solid white;\r\n  border-radius: ${pinSize}px;\r\n`\r\n\r\ntype Props = PinType & {\r\n    contextMenu(): void\r\n    translate(dx: number, dy: number): void\r\n    pointerdown(): void\r\n    pointer(): Position\r\n}\r\n\r\nexport function Pin(props: Props) {\r\n  const drag = useDrag((dx, dy) => props.translate(dx, dy), props.pointer)\r\n  const { x, y } = props.position\r\n\r\n  return (\r\n    <Styles\r\n      onPointerDown={e => {\r\n        e.stopPropagation()\r\n        e.preventDefault()\r\n        drag.start(e)\r\n        props.pointerdown()\r\n      }}\r\n      onContextMenu={e => {\r\n        e.stopPropagation()\r\n        e.preventDefault()\r\n        props.contextMenu()\r\n      }}\r\n      selected={props.selected}\r\n      style={{ position: 'absolute', top: `${y - pinSize / 2}px`, left: `${x - pinSize / 2}px` }}\r\n      data-testid=\"pin\"\r\n    >\r\n\r\n    </Styles>\r\n  )\r\n}\r\n","\r\nimport * as React from 'react'\r\nimport { BaseSchemes } from 'rete'\r\nimport { BaseAreaPlugin } from 'rete-area-plugin'\r\n\r\nimport { Position } from '../../types'\r\nimport { RenderPreset } from '../types'\r\nimport { Pin } from './Pin'\r\nimport { PinData, PinsRender } from './types'\r\n\r\ntype Props = {\r\n  translate?: (id: string, dx: number, dy: number) => void\r\n  contextMenu?: (id: string) => void\r\n  pointerdown?: (id: string) => void\r\n}\r\n\r\n/**\r\n * Preset for rendering pins.\r\n */\r\nexport function setup<Schemes extends BaseSchemes, K extends PinsRender>(props?: Props): RenderPreset<Schemes, K> {\r\n  function renderPins(data: PinData, pointer: () => Position) {\r\n    return <>\r\n      {data.pins.map(pin => (\r\n        <Pin\r\n          {...pin}\r\n          key={pin.id}\r\n          contextMenu={() => props?.contextMenu && props.contextMenu(pin.id)}\r\n          translate={(dx, dy) => props?.translate && props.translate(pin.id, dx, dy)}\r\n          pointerdown={() => props?.pointerdown && props.pointerdown(pin.id)}\r\n          pointer={pointer}\r\n        />\r\n      ))}\r\n    </>\r\n  }\r\n\r\n  return {\r\n    render(context, plugin) {\r\n      const data = context.data\r\n      const area = plugin.parentScope<BaseAreaPlugin<Schemes, PinsRender>>(BaseAreaPlugin)\r\n\r\n      if (data.type === 'reroute-pins') {\r\n        return renderPins(data.data, () => area.area.pointer)\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Built-in presets, responsible for rendering different parts of the editor.\r\n * @module\r\n */\r\nexport * as classic from './classic'\r\nexport * as contextMenu from './context-menu'\r\nexport * as minimap from './minimap'\r\nexport * as reroute from './reroute-pins'\r\n","import * as React from 'react'\r\nimport { BaseSchemes, CanAssignSignal, Scope } from 'rete'\r\n\r\nimport { RenderPreset } from './presets/types'\r\nimport { getRenderer, Renderer } from './renderer'\r\nimport { Position, RenderSignal } from './types'\r\nimport { Root } from './utils'\r\n\r\nexport * as Presets from './presets'\r\nexport type { ClassicScheme, ReactArea2D, RenderEmit } from './presets/classic'\r\nexport { RefComponent } from './ref-component'\r\nexport * from './shared'\r\nexport * from './types'\r\nexport { useRete } from './utils'\r\n\r\n/**\r\n * Signals that can be emitted by the plugin\r\n * @priority 9\r\n */\r\nexport type Produces<Schemes extends BaseSchemes> =\r\n  | { type: 'connectionpath', data: { payload: Schemes['Connection'], path?: string, points: Position[] } }\r\n\r\ntype Requires<Schemes extends BaseSchemes> =\r\n  | RenderSignal<'node', { payload: Schemes['Node'] }>\r\n  | RenderSignal<'connection', { payload: Schemes['Connection'], start?: Position, end?: Position }>\r\n  | { type: 'unmount', data: { element: HTMLElement } }\r\n\r\n/**\r\n * Plugin props\r\n */\r\nexport type Props = {\r\n  /** root factory for React.js 18+ */\r\n  createRoot?: (container: Element | DocumentFragment) => any\r\n}\r\n\r\n/**\r\n * React plugin. Renders nodes, connections and other elements using React.\r\n * @priority 10\r\n * @emits connectionpath\r\n * @listens render\r\n * @listens unmount\r\n */\r\nexport class ReactPlugin<Schemes extends BaseSchemes, T = Requires<Schemes>> extends Scope<Produces<Schemes>, [Requires<Schemes> | T]> {\r\n  renderer: Renderer\r\n  presets: RenderPreset<Schemes, T>[] = []\r\n\r\n  constructor(props?: Props) {\r\n    super('react-render')\r\n    this.renderer = getRenderer({ createRoot: props?.createRoot })\r\n\r\n    this.addPipe(context => {\r\n      if (!context || typeof context !== 'object' || !('type' in context)) return context\r\n      if (context.type === 'unmount') {\r\n        this.unmount(context.data.element)\r\n      } else if (context.type === 'render') {\r\n        if ('filled' in context.data && context.data.filled) {\r\n          return context\r\n        }\r\n        if (this.mount(context.data.element, context)) {\r\n          return {\r\n            ...context,\r\n            data: {\r\n              ...context.data,\r\n              filled: true\r\n            }\r\n          } as typeof context\r\n        }\r\n      }\r\n\r\n      return context\r\n    })\r\n  }\r\n\r\n  setParent(scope: Scope<Requires<Schemes> | T>): void {\r\n    super.setParent(scope)\r\n\r\n    this.presets.forEach(preset => {\r\n      if (preset.attach) preset.attach(this)\r\n    })\r\n  }\r\n\r\n  private mount(element: HTMLElement, context: Requires<Schemes>) {\r\n    const parent = this.parentScope()\r\n\r\n    for (const preset of this.presets) {\r\n      const result = preset.render(context as any, this)\r\n\r\n      if (!result) continue\r\n\r\n      const reactElement = (\r\n        <Root rendered={() => parent.emit({ type: 'rendered', data: context.data } as T)}>\r\n          {result}\r\n        </Root>\r\n      )\r\n\r\n      this.renderer.mount(reactElement, element)\r\n      return true\r\n    }\r\n  }\r\n\r\n  private unmount(element: HTMLElement) {\r\n    this.renderer.unmount(element)\r\n  }\r\n\r\n  /**\r\n   * Adds a preset to the plugin.\r\n   * @param preset Preset that can render nodes, connections and other elements.\r\n   */\r\n  public addPreset<K>(preset: RenderPreset<Schemes, CanAssignSignal<T, K> extends true ? K : 'Cannot apply preset. Provided signals are not compatible'>) {\r\n    const local = preset as RenderPreset<Schemes, T>\r\n\r\n    if (local.attach) local.attach(this)\r\n    this.presets.push(local)\r\n  }\r\n}\r\n"],"names":["getRenderer","props","createRoot","roots","WeakMap","mount","element","container","has","set","root","get","render","unmount","ReactDOM","unmountComponentAtNode","Root","_ref","children","rendered","useEffect","syncFlush","ready","useRef","current","apply","f","flushSync","error","message","includes","useRete","create","_useState","useState","_useState2","_slicedToArray","setContainer","editorRef","_useState3","_useState4","editor","setEditor","ref","destroy","innerHTML","then","value","ConnectionContext","createContext","start","end","path","ConnectionWrapper","computedStart","setStart","computedEnd","setEnd","_useState5","_useState6","setPath","flush","unwatch1","s","unwatch2","p","React","createElement","Provider","useConnection","useContext","Svg","styled","svg","_templateObject","_taggedTemplateLiteral","Path","_templateObject2","styles","Connection","_useConnection","d","copyEvent","e","newEvent","constructor","type","Object","getPrototypeOf","keys","getOwnPropertyNames","_iterator","_createForOfIteratorHelper","_step","n","done","k","item","defineProperty","err","rootPrefix","findReactRoot","_reactRootContainer","some","key","startsWith","parentElement","useDrag","translate","getPointer","previous","_objectSpread","move","moveEvent","dx","x","dy","y","up","window","removeEventListener","addEventListener","useNoDrag","disabled","handleClick","target","version","document","stopPropagation","dispatchEvent","el","NoDrag","Input","input","Control","_React$useState","data","_React$useState2","setValue","Drag","readOnly","readonly","onChange","val","$nodecolor","$nodecolorselected","$socketsize","$socketmargin","$socketcolor","$nodewidth","RefComponent","init","_objectWithoutProperties","_excluded","_extends","RefControl","name","emit","payload","className","RefSocket","nodeId","side","socketKey","NodeStyles","div","Number","isFinite","width","concat","height","selected","css","sortByIndex","entries","sort","a","b","_a$","_b$","ai","index","bi","Node","inputs","outputs","controls","_props$data","id","label","map","_ref2","output","socket","_ref3","_ref4","control","_ref5","_ref6","showControl","Styles","Hoverable","Socket","title","setup","positionWatcher","socketPositionWatcher","getDOMSocketPosition","customize","node","connection","attach","plugin","context","parent","parentScope","Component","sourceOutput","targetInput","source","change","listen","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","_response$data","points","curvature","wrap","_callee$","_context","prev","next","sent","abrupt","length","Error","isLoop","loopConnectionPath","classicConnectionPath","stop","_x","_x2","arguments","_Component","_Component2","ClassicPreset","InputControl","_Component3","useDebounce","cb","timeout","cancel","clearTimeout","func","setTimeout","$contextColor","$contextColorLight","$contextColorDark","$contextMenuRound","$width","CommonStyle","ItemStyle","hasSubitems","SubitemStyles","_templateObject3","ItemElement","_props$components","_props$components$ite","_props$components2","_props$components2$su","visibleSubitems","setVisibleSubitems","setInvisibile","useCallback","_useDebounce","delay","_useDebounce2","hide","cancelHide","components","call","Subitems","subitems","onClick","handler","Boolean","onPointerDown","onPointerOver","onPointerLeave","SearchInput","Search","component","onInput","Menu","_props$components$mai","_props$components2$co","_props$components3","_props$components3$se","onHide","filter","setFilter","filterRegexp","RegExp","filteredList","items","match","main","Common","common","onMouseOver","onMouseLeave","onWheel","searchBar","search","this","useLayoutEffect","px","MiniNode","style","left","top","MiniViewportStyles","MiniViewport","scale","v","containerWidth","invert","drag","pageX","pageY","Minimap","_useElementSize","useElementSize","_useElementSize2","containerRef","size","ratio","preventDefault","onDoubleClick","box","getBoundingClientRect","clientX","clientY","point","nodes","i","viewport","pinSize","Pin","pointer","_props$position","position","pointerdown","onContextMenu","contextMenu","renderPins","Fragment","pins","pin","area","BaseAreaPlugin","ReactPlugin","_Scope","_inherits","_super","_createSuper","_this","_classCallCheck","_defineProperty","_assertThisInitialized","renderer","addPipe","_typeof","filled","_createClass","setParent","scope","_this2","_get","_getPrototypeOf","prototype","presets","forEach","preset","result","reactElement","addPreset","local","push","Scope"],"mappings":"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"}